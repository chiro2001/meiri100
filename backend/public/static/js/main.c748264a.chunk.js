(this["webpackJsonpgbk-frontend"]=this["webpackJsonpgbk-frontend"]||[]).push([[0],{170:function(e,t,n){},186:function(e,t,n){},187:function(e,t,n){"use strict";n.r(t);var a=n(10),c=n.n(a),r=n(16),i=n(0),s=n.n(i),o=n(14),l=n.n(o),d=(n(170),n(8)),u=n(58),j=n(15),h=(n(171),n(3)),b=n(235),f=n(23),O=n(269),p=n(277),x=n(268),g=n(237),m=n(242),v=n(267),y=n(63),k=n(265),S=n(191),w=n(128),_=n.n(w),C=n(131),T=n.n(C),D=n(130),N=n.n(D),E=n(129),I=n.n(E),W=n(134),P=n.n(W),q=n(132),A=n.n(q),L=n(133),F=n.n(L),M=n(135),R=n.n(M),J=n(101),G=n.n(J),B=n(67),U=n(18),z=n(102),V=n(22),H=n(121),Y=n(28),K=n.n(Y),X=(n(115),n(76)),Q=n(122),Z=n(39),$=n(40),ee=n(136),te=n(229),ne=n(92);function ae(e){return new Promise((function(t){setTimeout(t,e)}))}function ce(e){return null!=e&&"function"===typeof e[Symbol.iterator]}function re(e){if(null===e||void 0===e)return e;if(ce(e)&&"string"!==typeof e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}if("object"===typeof e){var a={};for(var c in e)a[c]=re(e[c]);return a}return e}function ie(e,t){if(!e&&!t)return null;var n=re(e);for(var a in n||(n={}),t)n[a]=t[a];return n}function se(e,t){var n=Object.getOwnPropertyNames(e),a=Object.getOwnPropertyNames(t);if(n.length!==a.length)return!1;for(var c=0;c<n.length;c++){var r=n[c],i=e[r],s=t[r];if(!t.hasOwnProperty(r))return!1;if(i instanceof Object){if(!se(i,s))return!1}else if(i!==s)return!1}return!0}Date.prototype.setDay=function(e){var t=this.getDay();return t===e||this.setTime(this.getTime()+864e5*(e-t)),this},Date.prototype.toDateString=function(){return this.toISOString().slice(0,10)};var oe={"\u79d2":1,"\u5206":60,"\u65f6":3600,"\u5929":86400,"\u5468":604800};function le(e){if("number"!==typeof e)return"";var t=function(e){if("number"!==typeof e)return null;if(e>=oe[Object.keys(oe)[Object.keys(oe).length-1]])return Object.keys(oe)[Object.keys(oe).length-1];for(var t=1;t<Object.keys(oe).length;t++)if(e<oe[Object.keys(oe)[t]])return Object.keys(oe)[t-1];return Object.keys(oe)[0]}(e);return null===t?"":"".concat((e/oe[t]).toFixed(2)).concat(t)}var de=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];function ue(e){var t=0===e.length?0:parseFloat(e);return isNaN(t)?null:t}function je(e){return K()(e).format("YYYY-MM-DDTHH:mm:ss.SSSSSS+08:00")}function he(e){return function(t){t({type:"SET_CONFIG",data:e})}}function be(e){return function(t){t({type:"SET_TASKS",data:e})}}function fe(e){return function(t){t({type:"SET_USER",data:e})}}function Oe(e){return function(t){t({type:"SET_DAEMON",data:e})}}function pe(e){return function(t){t({type:"SET_ERROR_INFO",data:e})}}function xe(e){return function(t){t({type:"SET_MESSAGE",data:e})}}function ge(e,t){return n=ie(we.getState().types,Object(j.a)({},e,t)),function(e){e({type:"SET_TYPES",data:n})};var n}var me=new(function(){function e(){Object(Z.a)(this,e),this.host=window.location.href.includes("localhost")?"localhost":null,this.port=8880,this.api_version="v2",this.api_prefix="/api/".concat(this.api_version),this.protocol="http",this.url=this.host?"".concat(this.protocol,"://").concat(this.host,":").concat(this.port).concat(this.api_prefix):"".concat(this.api_prefix),this.access_token="",this.refresh_token=""}return Object($.a)(e,[{key:"set_token",value:function(e,t){void 0!==e&&(this.access_token=e),void 0!==t&&(this.refresh_token=t)}},{key:"get_token",value:function(){return{access_token:""===this.access_token?void 0:this.access_token,refresh_token:""===this.refresh_token?void 0:this.refresh_token}}},{key:"request_key",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",a=arguments.length>3?arguments[3]:void 0;return this.request("".concat(e,"/").concat(t),n,a)}},{key:"update_config",value:function(){var e=we.getState().config;e.data.api_token=this.get_token(),console.log("config.data.api_token",e.data.api_token),we.dispatch(he(e))}},{key:"load_from_config",value:function(){var e=we.getState().config;this.set_token(e.data.api_token.access_token,e.data.api_token.refresh_token)}},{key:"get_headers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={"Content-Type":"application/json"};return e&&(n.Refresh=this.refresh_token),t&&""!==this.access_token&&(n.Authorization=this.access_token),n}},{key:"request",value:function(){var e=Object(r.a)(c.a.mark((function e(t){var n,a,r,i,s,o,l,d,u,j,h,b,f=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:"GET",a=f.length>2?f[2]:void 0,r={method:n,mode:"cors",body:a?JSON.stringify(a):void 0,headers:this.get_headers(Boolean("session"===t&&"DELETE"===n))},i=null,e.prev=4,e.next=7,fetch("".concat(this.url,"/").concat(t),r);case 7:i=e.sent,e.next=16;break;case 10:return e.prev=10,e.t0=e.catch(4),console.error(e.t0),we.dispatch(pe(e.t0)),i={status:433,error:"Error when fetching internet"},e.abrupt("return",{code:i.status,error:i.statusText});case 16:return s=null,e.prev=17,e.next=20,i.json();case 20:s=e.sent,e.next=28;break;case 23:return e.prev=23,e.t1=e.catch(17),console.error(e.t1),we.dispatch(pe(e.t1)),e.abrupt("return",{code:i.status,error:i.statusText});case 28:if(console.log("raw js:",s),s||((s={}).message=i.statusText),void 0===s.code&&(s.code=i.status),422!==s.code){e.next=58;break}if(""!==this.refresh_token){e.next=34;break}return e.abrupt("return",null);case 34:return e.next=36,fetch("".concat(this.url,"/session"),{method:"GET",mode:"cors",headers:this.get_headers(!0)});case 36:return o=e.sent,e.prev=37,e.next=40,o.json();case 40:if(200!==(l=e.sent).code){e.next=48;break}this.set_token(l.data.access_token,l.data.refresh_token),this.update_config(),200===(d=this.request("user","GET")).code&&we.dispatch(fe(d.data.user)),e.next=50;break;case 48:return we.dispatch(pe("\u767b\u5f55\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55")),e.abrupt("return",null);case 50:e.next=55;break;case 52:return e.prev=52,e.t2=e.catch(37),e.abrupt("return",{code:o.status,error:o.statusText});case 55:return e.abrupt("return",this.request(t,n,a));case 58:if(424!==s.code){e.next=69;break}return we.dispatch(Oe(null)),e.next=62,this.request("remote_login","DELETE");case 62:return(u=we.getState().config).save(),we.dispatch(he(u)),we.dispatch(pe("\u8fdc\u7a0b\u767b\u5f55\u5931\u6548\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u7f8e\u56e2\u8d26\u53f7")),e.abrupt("return",s);case 69:200===s.code?"session"===t&&"POST"===n?(j=s.data,h=j.access_token,b=j.refresh_token,this.set_token(h,b),this.update_config()):"session"===t&&"DELETE"===n&&(this.set_token("",""),this.update_config()):we.dispatch(pe(s));case 70:return e.abrupt("return",s);case 71:case"end":return e.stop()}}),e,this,[[4,10],[17,23],[37,52]])})));return function(t){return e.apply(this,arguments)}}()}]),e}()),ve="group_bying_config",ye=function(){function e(){Object(Z.a)(this,e),this.load=this.load.bind(this),this.save=this.save.bind(this),this.theme_avaliable={"\u9ed8\u8ba4\u4e3b\u9898":Object(ee.a)({}),"\u9ed1\u6697\u6a21\u5f0f":Object(ee.a)({palette:{type:"dark",primary:{main:te.a[500]},secondary:{main:ne.a[500]}}})},this.data_default={debug:!1,version_frontend:.1,theme_name:"\u9ed8\u8ba4\u4e3b\u9898",theme_avaliable:["\u9ed8\u8ba4\u4e3b\u9898","\u9ed1\u6697\u6a21\u5f0f"],settings_async:!0,remote_login:{server:"ws://127.0.0.1:8081"},api_token:{}},this.data=this.data_default,this.theme=this.theme_avaliable["\u9ed8\u8ba4\u4e3b\u9898"],this.load()}return Object($.a)(e,[{key:"load",value:function(){console.log("Config: loading config..."),this.data.debug&&(console.log("Config: load default config."),this.save());try{if(this.data=JSON.parse(localStorage.getItem(ve)),!this.data)throw new Error("Null data");if(console.log("Got data:",this.data),!this.data.version_frontend||this.data.version_frontend<this.data_default.version_frontend){for(var e in console.log("Config: update ".concat(this.data.version_frontend," -> ").concat(this.data_default.version_frontend)),this.data.version_frontend=this.data_default.version_frontend,this.data_default)this.data[e]||(console.log("    Config: add value ".concat(e)),this.data[e]=this.data_default[e]);this.save()}}catch(t){console.warn("Can not find ".concat(ve," in localStorage, use default config.")),this.data=this.data_default,this.save()}this.theme=this.theme_avaliable[this.data.theme_name],this.theme||(this.theme=this.theme_avaliable.default),me.set_token(this.data.api_token.access_token,this.data.api_token.refresh_token)}},{key:"save",value:function(){console.log("Config: saving config..."),this.data.api_token=me.get_token();var e=JSON.stringify(this.data);return localStorage.setItem(ve,e),e}}],[{key:"clear",value:function(){console.log("Config: clearing all data..."),localStorage.setItem(ve,void 0)}}]),e}(),ke={config:new ye,tasks:[],user:null,daemon:null,errorInfo:null,message:null,types:{}};var Se=Object(X.b)({config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke.config,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CONFIG":return t.data;default:return e}},errorInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke.errorInfo,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ERROR_INFO":return t.data;default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke.message,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MESSAGE":return t.data;default:return e}},daemon:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke.daemon,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_DAEMON":return t.data;default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke.user,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":return t.data;default:return e}},tasks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke.tasks,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TASKS":return t.data;default:return e}},types:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke.types,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TYPES":return t.data;default:return e}}}),we=Object(X.c)(Se,Object(X.a)(Q.a)),_e=n(189),Ce=n(232),Te=n(233),De=n(1),Ne=!1;var Ee=function(e){var t=e.icon,n=e.primary,a=e.to,c=e.onClick,r=s.a.useMemo((function(){return s.a.forwardRef((function(e,t){return Object(De.jsx)(B.b,Object(u.a)({to:a,ref:t},e))}))}),[a]);return Ne||(Ne=!0,document.title="".concat(n," - \u56e2\u8d2d\u6740\u624b")),Object(De.jsx)("li",{children:Object(De.jsxs)(_e.a,{button:!0,component:r,onClick:function(){document.title="".concat(n," - \u56e2\u8d2d\u6740\u624b"),c&&c()},children:[t?Object(De.jsx)(Ce.a,{children:t}):null,Object(De.jsx)(Te.a,{primary:n})]})})},Ie=n(70),We=n(69),Pe=n(255),qe=n(137),Ae=n(234),Le=n(243),Fe=n(247),Me=n(280),Re=n(248),Je=n(240),Ge=n(273),Be=n(272),Ue=n(236),ze=n(271),Ve=n(105),He=n.n(Ve),Ye=n(126),Ke=n.n(Ye),Xe=n(42),Qe=n(257),Ze=n(258),$e=n(244),et=n(245),tt=n(262),nt=n(263),at=n(256),ct=n(261),rt=n(260),it=n(259),st=n(93),ot=n(249),lt=n(278),dt=n(274),ut=n(253),jt=n(254),ht=n(246),bt=n(52),ft=n.n(bt),Ot=n(250),pt=n(251),xt=n(252),gt=n(270);function mt(e){var t=e.value,n=e.onChange,a=e.onDelete;return Object(De.jsx)(ze.a,{children:null===t||void 0===t||"datetime|"===t?Object(De.jsx)(Ae.a,{color:"secondary",onClick:function(){n&&n(null)},children:"\u70b9\u51fb\u8bbe\u7f6e"}):Object(De.jsxs)(ze.a,{style:{display:"flex",flexDirection:"row"},children:[Object(De.jsx)(gt.a,{value:t.slice("datetime|".length),onChange:n}),Object(De.jsx)(S.a,{onClick:a,children:Object(De.jsx)(ft.a,{})})]})})}function vt(e){var t=e.defaultValue,n=e.open,a=e.onClose,c=e.title,r=e.keyNames,i=e.dataType,o=e.typeName,l=e.dismiss&&ce(e.dismiss)?e.dismiss:[],u=e.onSave?e.onSave:null,h=s.a.useState(t),b=Object(d.a)(h,2),f=b[0],O=b[1],p=function(e){return O(ie(f,e))},x=s.a.useState(!1),g=Object(d.a)(x,2),v=g[0],k=g[1],S=s.a.useState(null),w=Object(d.a)(S,2),_=w[0],C=w[1],T=s.a.useState(null),D=Object(d.a)(T,2),N=D[0],E=D[1],I=s.a.useState({}),W=Object(d.a)(I,2),P=W[0],q=W[1];return Object(De.jsxs)(Le.a,{fullWidth:!0,open:n,onClose:a,children:[Object(De.jsx)(Fe.a,{children:c}),Object(De.jsxs)($e.a,{children:[Object(De.jsx)(m.a,{style:{width:"100%"},children:Object.keys(f).map((function(e,t){if(l.indexOf(e)>=0)return null;var n=i&&o&&we.getState().types&&we.getState().types[o]&&we.getState().types[o][i]&&we.getState().types[o][i].args&&we.getState().types[o][i].args[e]?we.getState().types[o][i].args[e]:null;if(i&&o&&n&&!n.editable)return null;var a=r&&r[e]||e,c=f[e];if(!c&&"number"!==typeof c&&i&&o&&n&&(c="".concat(n.type,"|").concat(n.value?n.value:"")),"object"===typeof c)return Object(De.jsx)(_e.a,{button:!0,onClick:function(){C(c),E(a),k(!0)},children:a},e);var s=null;if("string"===typeof c&&c.startsWith("timezone|"))s=c.slice("timezone|".length);else if("string"===typeof c&&c.startsWith("datetime|"))s="datetime|"===c?Object(De.jsx)(Ae.a,{onClick:function(){p(Object(j.a)({},e,"datetime|".concat((new Date).toISOString())))},children:"\u70b9\u51fb\u8bbe\u7f6e"}):Object(De.jsx)(mt,{value:c,onChange:function(t){console.log("e",t),console.log("datetime|".concat(je(t))),p(Object(j.a)({},e,"datetime|".concat(je(t))))},onDelete:function(){p(Object(j.a)({},e,null))}});else if("string"===typeof c&&c.startsWith("timedelta|")){var d=c.slice("timedelta|".length),u=P[e]?P[e]:Object.keys(oe)[Object.keys(oe).length-1],h=function(){};s=Object(De.jsxs)(ze.a,{children:[Object(De.jsx)(lt.a,{value:"".concat(parseFloat(d)/oe[u]),onChange:function(t){var n=t.target.value;if(isNaN(parseFloat(n))){if(n.length>0)return;n=0}var a="timedelta|".concat(parseFloat(n)*oe[u]);p(Object(j.a)({},e,a))},onBlur:h}),Object(De.jsx)(Ge.a,{value:u,onChange:function(t){q(ie(P,Object(j.a)({},e,t.target.value)))},onBlur:h,children:Object.keys(oe).map((function(e,t){return Object(De.jsx)(Re.a,{value:e,children:e},e)}))})]})}else s=n&&"select"===n.type&&n.options?Object(De.jsxs)(ze.a,{style:{display:"flex",flexDirection:"row",justifyItems:"center",justifyContent:"center",alignContent:"center"},children:[Object(De.jsx)(ze.a,{children:"\u8bbe\u5b9a\u503c"}),Object(De.jsx)(Ge.a,{value:c,onChange:function(t){p(Object(j.a)({},e,t.target.value))},children:Object.keys(n.options).map((function(e){return Object(De.jsx)(Re.a,{value:e,children:n.options[e]},e)}))}),Object(De.jsx)(ze.a,{children:"\u5e93\u5b58\u91cf"})]}):Object(De.jsx)(lt.a,{value:"".concat(c),onChange:function(t){var n="number"===typeof c?ue(t.target.value):"".concat(c);null!==n&&p(Object(j.a)({},e,n))}});return Object(De.jsxs)(_e.a,{children:[Object(De.jsx)(Te.a,{children:a}),Object(De.jsx)(ot.a,{children:s})]},e)}))}),_&&N?Object(De.jsx)(vt,{defaultValue:_,open:v,onClose:function(){k(!1)},title:N}):void 0]}),u?Object(De.jsxs)(et.a,{children:[Object(De.jsx)(Ae.a,{color:"primary",onClick:function(){u&&u(f)},children:"\u4fdd\u5b58"}),Object(De.jsx)(Ae.a,{onClick:a,children:"\u53d6\u6d88"})]}):Object(De.jsx)(et.a,{children:Object(De.jsx)(ze.a,{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:Object(De.jsx)(y.a,{style:{height:"100%"},variant:"body1",color:"secondary",children:"\u65e0\u6cd5\u4fdd\u5b58"})})})]})}function yt(e){var t=e.data,n=e.open,a=e.onClose,c=e.title,r=e.keyNames,i=s.a.useState(!1),o=Object(d.a)(i,2),l=o[0],u=o[1],j=s.a.useState(null),h=Object(d.a)(j,2),b=h[0],f=h[1],O=s.a.useState(null),p=Object(d.a)(O,2),x=p[0],g=p[1];return Object(De.jsxs)(Le.a,{fullWidth:!0,open:n,onClose:a,children:[Object(De.jsx)(Fe.a,{children:c}),Object(De.jsxs)($e.a,{children:[Object(De.jsx)(m.a,{style:{width:"100%"},children:Object.keys(t).map((function(e,n){var a=r&&r[e]||e;if(t[e]){if("object"===typeof t[e])return Object(De.jsx)(_e.a,{button:!0,onClick:function(){f(t[e]),g(a),u(!0)},children:a},e);var c="".concat(t[e]);return Object(De.jsxs)(_e.a,{children:[Object(De.jsx)(Te.a,{children:a}),Object(De.jsx)(ot.a,{children:Object(De.jsx)(y.a,{variant:"body1",children:c.slice(0,20)+(c.length>20?"...":"")})})]},e)}}))}),b&&x?Object(De.jsx)(yt,{data:b,open:l,onClose:function(){u(!1)},title:x}):void 0]})]})}var kt={item_id:"\u76ee\u6807\u9879\u76eeID",target_price:"\u76ee\u6807\u4ef7\u683c",price_relative:"\u4ef7\u683c\u8c03\u6574\u5e45\u5ea6(\u4e0a\u8c03+x/\u4e0b\u8c03-x\u5143)"};function St(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"actions";try{return!se(e.data,we.getState().types[t][e.type].data)}catch(n){return!0}}function wt(e){return me.request("action","GET").then((function(t){we.dispatch(ge("actions",t.data.actions)),e&&e(t.data.actions)}))}function _t(e){return Ct.apply(this,arguments)}function Ct(){return(Ct=Object(r.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.action_type,a=null,we.getState().types.actions&&we.getState().types.actions[n]){e.next=7;break}return e.next=5,wt((function(e){a=e[n]}));case 5:e.next=8;break;case 7:a=we.getState().types.actions[n];case 8:if(a){e.next=10;break}return e.abrupt("return",null);case 10:return e.abrupt("return",ie(a,{data:t}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tt(e){if("number"!==typeof e)return"";for(var t={"\u79d2":1,"\u5206":60,"\u65f6":3600,"\u5929":86400,"\u5468":604800},n=1;n<Object.keys(t).length;n++)if(e<t[Object.keys(t)[n]])return"".concat((e/t[Object.keys(t)[n-1]]).toFixed(2)).concat(Object.keys(t)[n-1]);return"".concat((e/t[Object.keys(t)[Object.keys(t).length-1]]).toFixed(2)).concat(Object.keys(t)[Object.keys(t).length-1])}function Dt(e,t,n){var a="";if("object"===typeof e){for(var c in e){var r=kt&&kt[c]||c,i=n&&t&&we.getState().types&&we.getState().types[t]&&we.getState().types[t][n]&&we.getState().types[t][n].args&&we.getState().types[t][n].args[c]?we.getState().types[t][n].args[c]:null;if(!i||i.editable){var s=e[c];(s||"number"===typeof s)&&("string"===typeof s&&(s.startsWith("datetime|")?s=K()(s.slice("datetime|".length)).calendar():s.startsWith("timedelta|")&&(s=Tt(parseFloat(s.slice("timedelta|".length))))),a="".concat(0===a.length?"":a+"/").concat(r,":").concat(s))}}return a}}function Nt(e){var t=e.action,n=e.selectMode,a=e.onClick,c=e.onSave,r=e.fullWidth,i=e.targets,o=s.a.useState(!1),l=Object(d.a)(o,2),u=l[0],j=l[1];console.log("action",t);var h=s.a.useState(function(){if("adjust_price"===t.data.action_type&&i&&i.roomItem){var e=re(t);return e.data.item_id=i.roomItem.itemId,e.data.target_price=i.roomItem.price,e}if("adjust_price_relative"===t.data.action_type&&i&&i.roomItem){var n=re(t);return n.data.item_id=i.roomItem.itemId,n.data.price_relative=0,n}return t}()),b=Object(d.a)(h,2),f=b[0],O=(b[1],s.a.useState(!1)),p=Object(d.a)(O,2),x=p[0],g=p[1];if(a=a||function(){},!t)return null;var m=function(){j(!1)},v=function(e){var t=re(e||f);console.log("selected action:",t),a(t,n)};return Object(De.jsxs)(Ot.a,{style:{minWidth:200,margin:10,width:r?"100%":"auto"},children:[Object(De.jsxs)(pt.a,{onClick:n?function(){}:function(){v()},children:[Object(De.jsx)(y.a,{variant:"h5",children:t.name}),St(t,"actions")?Dt(t.data,"actions",t.type):Object(De.jsx)(y.a,{variant:"body1",children:t.desc}),Object(De.jsx)(vt,{keyNames:kt,open:u,dataType:t.type,typeName:"actions",onClose:m,defaultValue:f.data,onSave:function(e){var n=re(t);n.data=e,console.log("newData",e),c&&c(n),m(),x&&v(n)}})]}),n?Object(De.jsxs)(xt.a,{children:[Object(De.jsx)(Ae.a,{color:"primary",onClick:n?function(){v()}:function(){},children:"\u4f7f\u7528"}),Object(De.jsx)(Ae.a,{color:"primary",onClick:function(){j(!0),g(!0)},children:"\u4fee\u6539\u8bbe\u7f6e\u5e76\u4f7f\u7528"})]}):Object(De.jsx)(xt.a,{children:Object(De.jsx)(Ae.a,{color:St(t,"actions")?"primary":"secondary",onClick:function(){j(!0)},children:"\u4fee\u6539\u8bbe\u7f6e"})})]})}function Et(e){var t=e.selectMode,n=e.onClick,a=e.targets;n=n||function(){};var c=s.a.useState(!1),r=Object(d.a)(c,2),i=r[0],o=r[1],l=s.a.useReducer((function(e){return e+1}),0),u=Object(d.a)(l,2),j=(u[0],u[1]),h=we.getState().types.actions;console.log("targets",a),h||i||(o(!0),wt().then((function(){j()})));var b=null;return h?(console.log(h),b=Object(De.jsx)(ze.a,{style:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:Object.keys(h).map((function(e,c){return Object(De.jsx)(Nt,{targets:a,onClick:n,selectMode:t,action:e.includes("adjust_price")&&a&&a.roomItem&&a.roomItem.parent?function(){var t=re(h[e]);return t.data.periodDesc=a.roomItem.parent.periodDesc,t.data.roomName=a.roomItem.roomType,t.data.date=a.roomItem.parent.date,t.data.day=a.roomItem.parent.day,console.log("newAction",t),t}():h[e]},e)}))})):b=Object(De.jsx)(y.a,{variant:"body1",children:"\u6b63\u5728\u52a0\u8f7dAction\u7c7b\u578b..."}),Object(De.jsx)(ze.a,{children:b})}var It={start_date:"\u5f00\u59cb\u65f6\u95f4",end_date:"\u7ed3\u675f\u65f6\u95f4",interval:"\u95f4\u9694",run_date:"\u8fd0\u884c\u65f6\u95f4",value:"\u8bbe\u7f6e\u503c",operator:"\u6bd4\u8f83\u65b9\u5f0f"};function Wt(e){return me.request("trigger","GET").then((function(t){we.dispatch(ge("triggers",t.data.triggers)),e&&e(t.data.triggers)}))}function Pt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"triggers";try{return!se(e.data,we.getState().types[t][e.type].data)}catch(n){return!0}}function qt(e){return e.interval?"interval":e.run_date?"date":"cron"}function At(e){return Lt.apply(this,arguments)}function Lt(){return(Lt=Object(r.a)(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=qt(t),a=null,we.getState().types.triggers&&we.getState().types.triggers[n]){e.next=7;break}return e.next=5,Wt((function(e){a=e[n]}));case 5:e.next=8;break;case 7:a=we.getState().types.triggers[n];case 8:return e.abrupt("return",ie(a,{data:t}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ft(e,t,n){var a="";if("object"===typeof e){for(var c in e){var r=It&&It[c]||c,i=n&&t&&we.getState().types[t][n].args[c]?we.getState().types[t][n].args[c]:null;if(!i||i.editable){var s=e[c];s&&("string"===typeof s&&(s.startsWith("datetime|")?s=K()(s.slice("datetime|".length)).calendar():s.startsWith("timedelta|")&&(s=le(parseFloat(s.slice("timedelta|".length))))),a="".concat(0===a.length?"":a+"/").concat(r,":").concat(s))}}return a}}function Mt(e){var t=e.trigger,n=e.selectMode,a=e.onClick,c=e.onSave,r=e.fullWidth,i=s.a.useState(!1),o=Object(d.a)(i,2),l=o[0],u=o[1],j=s.a.useState(!1),h=Object(d.a)(j,2),b=h[0],f=h[1];if(a=a||function(){},!t)return null;var O=function(){u(!1)},p=function(e){a(e||t,n)};return console.log("bug trigger",t),Object(De.jsxs)(Ot.a,{style:{minWidth:200,margin:10,width:r?"100%":"auto"},children:[Object(De.jsxs)(pt.a,{onClick:n?function(){}:function(){p()},children:[Object(De.jsx)(y.a,{variant:"h5",children:t.name}),Pt(t,"triggers")?Ft(t.data,"triggers",t.type):Object(De.jsx)(y.a,{variant:"body1",children:t.desc}),Object(De.jsx)(vt,{dismiss:["version","timezone"],keyNames:It,open:l,dataType:t.type,typeName:"triggers",onClose:O,defaultValue:t.data,onSave:function(e){var n=re(t);n.data=e,console.log(e),c&&c(n),O(),b&&p(n)}})]}),n?Object(De.jsxs)(xt.a,{children:[Object(De.jsx)(Ae.a,{color:"primary",onClick:n?function(){p()}:function(){},children:"\u4f7f\u7528"}),Object(De.jsx)(Ae.a,{color:"primary",onClick:function(){u(!0),f(!0)},children:"\u4fee\u6539\u8bbe\u7f6e\u5e76\u4f7f\u7528"})]}):Object(De.jsx)(xt.a,{children:Object(De.jsx)(Ae.a,{color:Pt(t,"triggers")?"primary":"secondary",onClick:function(){u(!0)},children:"\u4fee\u6539\u8bbe\u7f6e"})})]})}function Rt(e){var t=e.selectMode,n=e.onClick;n=n||function(){};var a=s.a.useState(!1),c=Object(d.a)(a,2),r=c[0],i=c[1],o=s.a.useReducer((function(e){return e+1}),0),l=Object(d.a)(o,2),u=(l[0],l[1]),j=we.getState().types.triggers;j||r||(i(!0),Wt().then((function(){u()}))),console.log("types",we.getState().types);var h=null;return h=j?Object(De.jsx)(ze.a,{style:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:Object.keys(j).map((function(e,a){return Object(De.jsx)(Mt,{onClick:n,selectMode:t,trigger:j[e]},e)}))}):Object(De.jsx)(y.a,{variant:"body1",children:"\u6b63\u5728\u52a0\u8f7d\u89e6\u53d1\u5668\u7c7b\u578b..."}),Object(De.jsx)(ze.a,{children:h})}var Jt=!1,Gt=Object(b.a)((function(e){return{nested:{paddingLeft:e.spacing(4)},centerText:{display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap"}}}));function Bt(e){Jt=e}var Ut=!1;function zt(e){var t=Gt(),n=e.addMode,a=e.open,i=e.onClose,o=e.onRefresh,l=e.onSave,u=e.targets,h=e.simpleMode,b=!0===e.taskOld?null:e.taskOld;console.log("targets",u);var f=u&&u.taskName?u.taskName:"\u672a\u547d\u540d\u4efb\u52a1",O={task_name:f,triggers:[],actions:[]},p=n?e.defaultTask?e.defaultTask:O:b||(e.defaultTask?e.defaultTask:O),x={timenode:!1,cycle:!1,stock:!1},g={">":"\u5927\u4e8e","<":"\u5c0f\u4e8e","==":"\u7b49\u4e8e",">=":"\u5927\u4e8e\u7b49\u4e8e","<=":"\u5c0f\u4e8e\u7b49\u4e8e","!=":"\u4e0d\u7b49\u4e8e"},v=s.a.useState({dialogAddTaskOpen:!1,dialogAddTriggerOpen:!1,dialogAddActionOpen:!1,dialogUpdateTrigger:!1,task:p,requestingTaskData:!1,defaultTid:null,useSimpleMode:h,collapseOpen:x,simpleData:{timenodeTime:"datetime|".concat(je(new Date)),timenodePrice:100,cycleTime:"timedelta|".concat(oe["\u5468"]),cyclePrice:100,stockOperator:">",stockPrice:100,stockValue:5}}),y=Object(d.a)(v,2),k=y[0],w=y[1],_=function(e){return w(ie(k,e))},C=function(e){_({collapseOpen:ie(x,Object(j.a)({},e,!k.collapseOpen[e]))})},T=s.a.useReducer((function(e){return e+1}),0),D=Object(d.a)(T,2),N=(D[0],D[1]),E=we.getState().types.task_data;if(!Ut&&u&&u.roomItem){Ut=!0;try{_({simpleData:ie(k.simpleData,{timenodePrice:u&&u.roomItem?u.roomItem.price:k.simpleData.timenodePrice,cyclePrice:u&&u.roomItem?u.roomItem.price:k.simpleData.cyclePrice})})}catch(P){Ut=!1,console.error(P)}}(!n&&(Jt||se(k.task,O)&&!se(p,O))||Jt)&&(Jt=!1,_({task:p})),k.requestingTaskData||E||(_({requestingTaskData:!0}),me.request("task","PATCH").then((function(e){var t=e.data.task_data;t.tid=null,we.dispatch(ge("task_data",t)),N()})));var I=n?function(){if(!E)return pe("Task\u6570\u636e\u4e3a\u7a7a\u3002"),void console.error("Task\u6570\u636e\u4e3a\u7a7a\u3002");var e=ie(E,k.task);return console.log("task",e),me.request("task","POST",{task:e}).then((function(e){if(200===e.code){var t=e.data.tid?e.data.tid+1:null;_({defaultTid:t,taskName:we.getState().types.task_data?"".concat(f).concat(t||""):f}),o&&o()}}))}:function(){if(b){var e=ie(b,k.task);return console.log("task",e),l?l(e):new Promise((function(e,t){e()}))}},W=k.useSimpleMode?Object(De.jsxs)(m.a,{children:[h?Object(De.jsx)(_e.a,{children:Object(De.jsx)(Ae.a,{variant:"outlined",onClick:function(){_({useSimpleMode:!k.useSimpleMode})},fullWidth:!0,color:"secondary",children:"\u9ad8\u7ea7\u6a21\u5f0f"})}):null,Object(De.jsxs)(_e.a,{children:[Object(De.jsx)(Te.a,{primary:"\u8ba1\u5212\u540d\u79f0"}),Object(De.jsx)(ot.a,{children:Object(De.jsx)(lt.a,{value:k.task.task_name,onChange:function(e){var t=re(k.task);t.task_name=e.target.value,_({task:t})}})})]}),Object(De.jsx)(_e.a,{button:!0,onClick:function(){C("timenode")},children:Object(De.jsxs)(ze.a,{style:{display:"flex",flexFlow:"row"},children:[Object(De.jsx)(dt.a,{checked:k.collapseOpen.timenode}),Object(De.jsx)(ze.a,{children:Object(De.jsx)(ze.a,{className:t.centerText,style:{height:"100%"},children:"\u5728\u67d0\u4e00\u4e2a\u65f6\u95f4\u70b9\u6539\u53d8\u4ef7\u683c"})})]})}),Object(De.jsx)(ut.a,{in:k.collapseOpen.timenode,timeout:"auto",unmountOnExit:!0,className:t.nested,children:Object(De.jsxs)(ze.a,{style:{display:"flex",flexFlow:"row",justifyContent:"space-between"},children:[Object(De.jsx)(ze.a,{className:t.centerText,children:"\u5728"}),Object(De.jsx)(mt,{value:k.simpleData.timenodeTime,onChange:function(e){_(e?{simpleData:ie(k.simpleData,{timenodeTime:"datetime|".concat(je(e))})}:{simpleData:ie(k.simpleData,{timenodeTime:"datetime|".concat(je(new Date))})})},onDelete:function(){_({simpleData:ie(k.simpleData,{timenodeTime:"datetime|"})})}}),Object(De.jsx)(ze.a,{className:t.centerText,children:"\u8c03\u6574\u4ef7\u683c\u5230"}),Object(De.jsx)(lt.a,{style:{maxWidth:60},inputProps:{style:{textAlign:"center"}},value:"".concat(k.simpleData.timenodePrice),onChange:function(e){var t=ue(e.target.value);null!==t&&_({simpleData:ie(k.simpleData,{timenodePrice:t})})}})]})}),Object(De.jsx)(_e.a,{button:!0,onClick:function(){C("cycle")},children:Object(De.jsxs)(ze.a,{style:{display:"flex",flexFlow:"row"},children:[Object(De.jsx)(dt.a,{checked:k.collapseOpen.cycle}),Object(De.jsx)(ze.a,{children:Object(De.jsx)(ze.a,{className:t.centerText,style:{height:"100%"},children:"\u5468\u671f\u6027\u6539\u53d8\u4ef7\u683c"})})]})}),Object(De.jsx)(ut.a,{in:k.collapseOpen.cycle,timeout:"auto",unmountOnExit:!0,className:t.nested,children:Object(De.jsxs)(ze.a,{style:{display:"flex",flexFlow:"row",justifyContent:"space-between"},children:[Object(De.jsx)(ze.a,{className:t.centerText,children:"\u6bcf\u9694"}),Object(De.jsx)(lt.a,{style:{maxWidth:60},inputProps:{style:{textAlign:"center"}},value:"".concat(parseFloat(k.simpleData.cycleTime.slice("timedelta|".length))/oe["\u5929"]),onChange:function(e){var t=parseFloat(e.target.value);console.log(t);var n=ue("".concat(t));null!==n&&_({simpleData:ie(k.simpleData,{cycleTime:"timedelta|".concat(n*oe["\u5929"])})})}}),Object(De.jsx)(ze.a,{className:t.centerText,children:"\u5929\uff0c\u8c03\u6574\u4ef7\u683c\u5230"}),Object(De.jsx)(lt.a,{style:{maxWidth:60},inputProps:{style:{textAlign:"center"}},value:"".concat(k.simpleData.cyclePrice),onChange:function(e){var t=ue(e.target.value);null!==t&&_({simpleData:ie(k.simpleData,{cyclePrice:t})})}})]})}),Object(De.jsx)(_e.a,{button:!0,onClick:function(){C("stock")},children:Object(De.jsxs)(ze.a,{style:{display:"flex",flexFlow:"row"},children:[Object(De.jsx)(dt.a,{checked:k.collapseOpen.stock}),Object(De.jsx)(ze.a,{children:Object(De.jsx)(ze.a,{className:t.centerText,style:{height:"100%"},children:"\u6839\u636e\u5e93\u5b58\u6539\u53d8\u4ef7\u683c"})})]})}),Object(De.jsx)(ut.a,{in:k.collapseOpen.stock,timeout:"auto",unmountOnExit:!0,className:t.nested,children:Object(De.jsxs)(ze.a,{style:{display:"flex",flexFlow:"row",justifyContent:"space-between"},children:[Object(De.jsx)(ze.a,{className:t.centerText,children:"\u5728(\u8bbe\u5b9a\u503c)"}),Object(De.jsx)(lt.a,{style:{maxWidth:60},inputProps:{style:{textAlign:"center"}},value:"".concat(k.simpleData.stockValue),onChange:function(e){var t=ue(e.target.value);null!==t&&_({simpleData:ie(k.simpleData,{stockValue:t})})}}),Object(De.jsx)(Ge.a,{value:k.simpleData.stockOperator,onChange:function(e){_({simpleData:ie(k.simpleData,{stockOperator:e.target.value})})},children:Object.keys(g).map((function(e){return Object(De.jsx)(Re.a,{value:e,children:g[e]},e)}))}),Object(De.jsx)(ze.a,{className:t.centerText,children:"\u5e93\u5b58\u503c\u7684\u65f6\u5019"}),Object(De.jsx)(ze.a,{className:t.centerText,children:"\u8c03\u6574\u4ef7\u683c\u5230"}),Object(De.jsx)(lt.a,{style:{maxWidth:60},inputProps:{style:{textAlign:"center"}},value:"".concat(k.simpleData.stockPrice),onChange:function(e){var t=ue(e.target.value);null!==t&&_({simpleData:ie(k.simpleData,{stockPrice:t})})}})]})})]}):Object(De.jsxs)(m.a,{children:[h?Object(De.jsx)(_e.a,{children:Object(De.jsx)(Ae.a,{variant:"outlined",onClick:function(){_({useSimpleMode:!k.useSimpleMode})},fullWidth:!0,color:"secondary",children:"\u7b80\u5355\u6a21\u5f0f"})}):null,Object(De.jsx)(jt.a,{children:"\u8ba1\u5212\u540d\u79f0"}),Object(De.jsx)(_e.a,{children:Object(De.jsx)(lt.a,{fullWidth:!0,value:k.task.task_name,onChange:function(e){var t=re(k.task);t.task_name=e.target.value,_({task:t})}})}),Object(De.jsx)(jt.a,{children:"\u89e6\u53d1\u5668\u5217\u8868"}),k.task.triggers.map((function(e,t){return Object(De.jsxs)(_e.a,{children:[Object(De.jsx)(Mt,{fullWidth:!0,trigger:e,onSave:function(e){console.log("saveing",e);var n=re(k.task);n.triggers[t]=e,_({task:n})}}),Object(De.jsx)(ot.a,{children:Object(De.jsx)(S.a,{onClick:function(){var e=re(k.task);e.triggers.splice(t,1),_({task:e})},children:Object(De.jsx)(ft.a,{})})})]},e)})),Object(De.jsx)(jt.a,{children:"Actions\u5217\u8868"}),k.task.actions.map((function(e,t){return Object(De.jsxs)(_e.a,{children:[Object(De.jsx)(Nt,{fullWidth:!0,action:e,onSave:function(e){console.log("saveing",e);var n=re(k.task);n.actions[t]=e,_({task:n})}}),Object(De.jsx)(ot.a,{children:Object(De.jsx)(S.a,{onClick:function(){var e=re(k.task);e.actions.splice(t,1),_({task:e})},children:Object(De.jsx)(ft.a,{})})})]},e)})),Object(De.jsx)(_e.a,{children:Object(De.jsxs)(ht.a,{container:!0,spacing:5,children:[Object(De.jsx)(ht.a,{item:!0,xs:12,lg:6,children:Object(De.jsx)(Ae.a,{fullWidth:!0,onClick:function(){_({dialogAddTriggerOpen:!0})},color:"primary",variant:"outlined",children:"\u6dfb\u52a0\u89e6\u53d1\u5668"})}),Object(De.jsx)(ht.a,{item:!0,xs:12,lg:6,children:Object(De.jsx)(Ae.a,{fullWidth:!0,onClick:function(){_({dialogAddActionOpen:!0})},color:"primary",variant:"outlined",children:"\u6dfb\u52a0Action"})})]})})]});return Object(De.jsxs)(Le.a,{fullWidth:!0,open:a,onClose:function(){i&&i(!1)},children:[Object(De.jsx)(Fe.a,{children:n?"\u6dfb\u52a0\u65b0\u4efb\u52a1":"\u8bbe\u7f6e\u4efb\u52a1"}),Object(De.jsxs)($e.a,{children:[W,Object(De.jsxs)(Le.a,{open:k.dialogAddTriggerOpen,onClose:function(){return _({dialogAddTriggerOpen:!1})},children:[Object(De.jsx)(Fe.a,{children:"\u9009\u62e9\u4e00\u4e2a\u89e6\u53d1\u5668"}),Object(De.jsx)($e.a,{children:Object(De.jsx)(Rt,{targets:u,onClick:function(e){console.log("trigger",e);var t=re(k.task);t.triggers.push(e),_({dialogAddTriggerOpen:!1,task:t})},selectMode:!0})})]}),Object(De.jsxs)(Le.a,{open:k.dialogAddActionOpen,onClose:function(){return _({dialogAddActionOpen:!1})},children:[Object(De.jsx)(Fe.a,{children:"\u9009\u62e9\u4e00\u4e2aAction"}),Object(De.jsx)($e.a,{children:Object(De.jsx)(Et,{targets:u,onClick:function(e){console.log("action",e);var t=re(k.task);t.actions.push(e),_({dialogAddActionOpen:!1,task:t})},selectMode:!0})})]})]}),Object(De.jsxs)(et.a,{children:[Object(De.jsx)(Ae.a,{color:"primary",disabled:k.useSimpleMode?function(){for(var e in k.collapseOpen)if(k.collapseOpen[e])return!1;return!0}():0===k.task.triggers.length||0===k.task.actions.length,onClick:Object(r.a)(c.a.mark((function e(){var t,n,a,r,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.useSimpleMode){e.next=4;break}I().then((function(){_({task:p}),i&&i(!0)})),e.next=45;break;case 4:if((!u||u&&!u.roomItem)&&console.warn("targets error"),t=[],n=[],!we.getState().types.triggers){e.next=10;break}e.t0=we.getState().types.triggers,e.next=13;break;case 10:return e.next=12,new Promise((function(e,t){Wt((function(t){e(t)}))}));case 12:e.t0=e.sent;case 13:if(e.t1=e.t0,!we.getState().types.actions){e.next=18;break}e.t2=we.getState().types.actions,e.next=21;break;case 18:return e.next=20,new Promise((function(e,t){wt((function(t){e(t)}))}));case 20:e.t2=e.sent;case 21:e.t3=e.t2,a={triggers:e.t1,actions:e.t3},e.t4=c.a.keys(k.collapseOpen);case 24:if((e.t5=e.t4()).done){e.next=38;break}if(r=e.t5.value,!k.collapseOpen[r]){e.next=36;break}if("timenode"!==r){e.next=35;break}if("datetime|"!==k.simpleData.timenodeTime){e.next=31;break}return we.dispatch(xe("\u65f6\u95f4\u70b9\u672a\u8bbe\u7f6e")),e.abrupt("return");case 31:t.push(ie(a.triggers.date,{data:ie(a.triggers.date.data,{run_date:k.simpleData.timenodeTime})})),n.push(ie(a.actions.adjust_price,{data:ie(a.actions.adjust_price.data,{target_price:k.simpleData.timenodePrice,item_id:u.roomItem.itemId})})),e.next=36;break;case 35:"cycle"===r?(t.push(ie(a.triggers.interval,{data:ie(a.triggers.interval.data,{interval:k.simpleData.cycleTime})})),n.push(ie(a.actions.adjust_price,{data:ie(a.actions.adjust_price.data,{target_price:k.simpleData.timenodePrice,item_id:u.roomItem.itemId})}))):"stock"===r&&(t.push(ie(a.triggers.stock,{data:ie(a.triggers.stock.data,{value:k.simpleData.stockValue,operator:k.simpleData.stockOperator})})),n.push(ie(a.actions.adjust_price,{data:ie(a.actions.adjust_price.data,{target_price:k.simpleData.timenodePrice,item_id:u.roomItem.itemId})})));case 36:e.next=24;break;case 38:if(0!==t.length&&0!==n.length){e.next=41;break}return console.warn("Must select actions / triggers"),e.abrupt("return");case 41:return s=ie(k.task,{triggers:t,actions:n}),e.next=44,me.request("task","POST",{task:s});case 44:i&&i(!0);case 45:case"end":return e.stop()}}),e)}))),children:"\u786e\u5b9a"}),Object(De.jsx)(Ae.a,{onClick:function(){i&&i(!1)},children:"\u53d6\u6d88"})]})]})}function Vt(e){return Ht.apply(this,arguments)}function Ht(){return(Ht=Object(r.a)(c.a.mark((function e(t){var n,a,r,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=we.getState().types.task_data){e.next=3;break}return e.abrupt("return");case 3:a=ie(n,t),r=0;case 5:if(!(r<a.triggers.length)){e.next=12;break}return e.next=8,At(a.triggers[r]);case 8:a.triggers[r]=e.sent;case 9:r++,e.next=5;break;case 12:i=0;case 13:if(!(i<a.actions.length)){e.next=20;break}return e.next=16,_t(a.actions[i]);case 16:a.actions[i]=e.sent;case 17:i++,e.next=13;break;case 20:if(!a.triggers.includes(null)&&!a.actions.includes(null)){e.next=22;break}return e.abrupt("return",null);case 22:return e.abrupt("return",a);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yt(e){var t=e.task,n=e.onUpdate,a=e.onClick;return Object(De.jsxs)(_e.a,{button:!0,onClick:Object(r.a)(c.a.mark((function e(){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return n=re(t),console.log("task before",n),e.prev=4,e.next=7,Vt(n);case 7:r=e.sent,console.log("task after",r),r&&a&&a(r),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[4,12]])}))),children:[Object(De.jsxs)(Te.a,{children:[Object(De.jsx)(ze.a,{children:Object(De.jsx)(y.a,{variant:"h5",children:t.task_name})}),Object(De.jsx)(ze.a,{children:Object(De.jsx)(y.a,{variant:"body2",children:"tid:".concat(t.tid,"/\u89e6\u53d1\u5668:").concat(t.triggers.length,"/Action:").concat(t.actions.length)})})]}),Object(De.jsx)(ot.a,{children:Object(De.jsx)(S.a,{onClick:function(){me.request_key("task",t.tid,"DELETE").then((function(e){200!==e.code&&we.dispatch(pe(e)),n&&n()}))},children:Object(De.jsx)(ft.a,{})})})]})}function Kt(e){var t=we.getState().tasks;if(!e||!e.roomItem||e.roomItem&&"{}"===JSON.stringify(e.roomItem))return t;var n,a=[],c=Object(Xe.a)(t);try{for(c.s();!(n=c.n()).done;){var r,i=n.value,s=Object(Xe.a)(i.actions);try{for(s.s();!(r=s.n()).done;){var o=r.value;if(!o)return[];var l=o.data?o.data:o;if(l.action_type.includes("adjust_price")&&e.roomItem&&l.item_id===e.roomItem.itemId){a.push(i);break}}}catch(d){s.e(d)}finally{s.f()}}}catch(d){c.e(d)}finally{c.f()}return a}function Xt(e){return we.getState().tasks.map((function(t,n){var a,c=Object(Xe.a)(t.actions);try{for(c.s();!(a=c.n()).done;){var r=a.value,i=r.data?r.data:r;if(i.action_type.includes("adjust_price")){if(e&&e.roomItem&&i.item_id===e.roomItem.itemId)return!0;if(!e)return!0}}}catch(s){c.e(s)}finally{c.f()}return!1}))}function Qt(e){var t=e.onClick,n=e.onUpdate,a=e.targets,c=e.fullWidth,r=e.tasks?e.tasks:we.getState().tasks,i=e.tasks?Xt(null):Xt(a);return r.length>0?Object(De.jsx)(m.a,{children:r.map((function(e,a){return i[a]?Object(De.jsx)(Yt,{onClick:t,onUpdate:n,task:e},e):null}))}):Object(De.jsx)(m.a,{style:{width:c?"100%":null},children:Object(De.jsx)(_e.a,{children:Object(De.jsx)(y.a,{variant:"body1",color:"textSecondary",children:"\u7a7a\u5217\u8868"})})})}function Zt(e){var t=s.a.useState({requestingTasks:!1,dialogAddTaskOpen:!1,addMode:!0,task:null}),n=Object(d.a)(t,2),a=n[0],c=n[1],r=we.getState().tasks,i=s.a.useReducer((function(e){return e+1}),0),o=Object(d.a)(i,2),l=(o[0],o[1]),u=function(e){return c(ie(a,e))};return a.requestingTasks||(u({requestingTasks:!0}),me.request("task","GET").then((function(e){200===e.code?(we.dispatch(be(e.data.tasks)),l()):we.dispatch(pe(e))}))),Object(De.jsxs)(Pe.a,{children:[Object(De.jsxs)(ht.a,{container:!0,spacing:3,children:[Object(De.jsxs)(ht.a,{item:!0,lg:8,sm:12,children:[Object(De.jsx)(y.a,{variant:"h4",children:"\u4efb\u52a1\u5217\u8868"}),Object(De.jsx)(Qt,{onClick:function(e){console.log("Task: onClick",e),Bt(!0),u({dialogAddTaskOpen:!0,addMode:!1,task:e})},onUpdate:function(){u({requestingTasks:!1})}})]}),Object(De.jsx)(ht.a,{item:!0,lg:4,sm:12,children:Object(De.jsx)(Pe.a,{maxWidth:"xs",children:Object(De.jsxs)(m.a,{children:[Object(De.jsx)(jt.a,{children:"\u65b0\u4efb\u52a1"}),Object(De.jsx)(_e.a,{children:Object(De.jsx)(Ae.a,{fullWidth:!0,variant:"contained",color:"secondary",onClick:function(){Bt(!0),u({dialogAddTaskOpen:!0,addMode:!0})},children:"\u6dfb\u52a0\u65b0\u4efb\u52a1"})}),Object(De.jsx)(_e.a,{children:Object(De.jsx)(Ae.a,{fullWidth:!0,variant:"contained",children:"\u8bbe\u7f6e\u9ed8\u8ba4\u4efb\u52a1"})}),Object(De.jsx)(jt.a,{children:"\u5168\u90e8\u4efb\u52a1\u7ba1\u7406"}),Object(De.jsx)(_e.a,{children:Object(De.jsx)(Ae.a,{fullWidth:!0,disabled:0===r.length,variant:"outlined",onClick:function(){var e={};r.map((function(t){return e=Object.assign(e,Object(j.a)({},t.tid,t.tid)),null})),me.request("task","DELETE",{tids:e}).then((function(e){u({requestingTasks:!1})}))},children:"\u5220\u9664\u5168\u90e8\u4efb\u52a1"})})]})})})]}),Object(De.jsx)(zt,{taskOld:a.task,addMode:a.addMode,open:a.dialogAddTaskOpen,onRefresh:function(){u({requestingTasks:!1})},onClose:function(){u({dialogAddTaskOpen:!1})},onSave:function(e){return me.request_key("task",e.tid,"POST",{task:e}).then((function(e){u({requestingTasks:!1})}))}})]})}var $t=Object(b.a)({table:{minWidth:1500},foodDesc:{overflow:"hidden",whiteSpace:"nowrap",contentOverflow:"ellipsis",maxWidth:160},planButton:{overflow:"hidden",whiteSpace:"nowrap",contentOverflow:"ellipsis",maxWidth:160}});function en(e){var t=Object.assign(e.style?e.style:{},{padding:3});return e.noBorder&&(t.borderBottom="0"),Object(De.jsx)(at.a,{align:e.align,colSpan:e.colSpan,style:t,children:e.children})}var tn=null,nn=null;var an=function(e){var t=$t(),n=s.a.useState(!1),a=Object(d.a)(n,2),c=a[0],r=a[1],i=s.a.useState(!1),o=Object(d.a)(i,2),l=o[0],u=o[1],j=s.a.useReducer((function(e){return e+1}),0),h=Object(d.a)(j,2),b=(h[0],h[1]),f=e.day,O=e.data,p=(new Date).setDay(f).toDateString(),x=s.a.useState(O),g=Object(d.a)(x,2),m=g[0],v=g[1],y=s.a.useState(we.getState().daemon&&we.getState().daemon.reserve_table&&we.getState().daemon.reserve_table[p]?we.getState().daemon.reserve_table[p].roomList:[]),k=Object(d.a)(y,2),S=k[0],w=k[1],_=s.a.useState(null),C=Object(d.a)(_,2),T=C[0],D=C[1],N=s.a.useState(null),E=Object(d.a)(N,2),I=E[0],W=E[1],P=s.a.useState({}),q=Object(d.a)(P,2),A=q[0],L=q[1],F=s.a.useState(!1),M=Object(d.a)(F,2),R=M[0],J=M[1];if(R||we.getState().tasks&&!we.getState().tasks&&0!==we.getState().tasks.length||(J(!0),me.request("task","GET").then((function(e){200===e.code&&(we.dispatch(be(e.data.tasks)),b())}))),!we.getState().daemon)return c||(r(!0),me.request("daemon","GET").then((function(e){200===e.code&&we.dispatch(Oe(e.data))}))),Object(De.jsx)(Qe.a,{});if(!we.getState().daemon.reserve_table)return l||(u(!0),me.request("daemon","POST",{daemon_args:{update_all:!0}}).then((function(e){200===e.code&&we.dispatch(Oe(e.data))}))),Object(De.jsx)(Qe.a,{});tn="{}"!==JSON.stringify(we.getState().daemon.reserve_table[p])&&void 0!==JSON.stringify(we.getState().daemon.reserve_table[p]);var G=function(e){var t,n=$t(),a=e.data,c=e.roomList,r={},i=[],s={},o=Object(Xe.a)(a.periodList);try{for(o.s();!(t=o.n()).done;){var l=t.value;r[l.periodId]={},s[l.periodId]=l,i.push({id:l.periodId,desc:l.periodDesc});var d,u=Object(Xe.a)(c);try{for(u.s();!(d=u.n()).done;){var j=d.value;r[l.periodId][j.roomName]=[]}}catch(q){u.e(q)}finally{u.f()}for(var h in l.roomMapItemEntry){r[l.periodId][h]||(r[l.periodId][h]=[]);var b,O=Object(Xe.a)(l.roomMapItemEntry[h]);try{for(O.s();!(b=O.n()).done;){var x=b.value;r[l.periodId][h].push(x)}}catch(q){O.e(q)}finally{O.f()}}}}catch(q){o.e(q)}finally{o.f()}for(var g=[],m={},v=0,y=i;v<y.length;v++){var k=y[v].id;if(r[k]){for(var S=0;;){var w,_=!1,C=Object(Xe.a)(c);try{for(C.s();!(w=C.n()).done;){var T=w.value;r[k][T.roomName]&&r[k][T.roomName]&&r[k][T.roomName][S]&&(_=!0)}}catch(q){C.e(q)}finally{C.f()}if(!_)break;S++}m[k]=S}}for(var N=function(e,t,n,a){return e==parseInt(t/2)?t%2===1?e===t-1?Object(De.jsx)(en,{align:"center",colSpan:1,children:n},a):Object(De.jsx)(en,{align:"center",noBorder:!0,colSpan:1,children:n},a):e===t-1?Object(De.jsx)(en,{align:"center",colSpan:1,children:Object(De.jsx)(ze.a,{style:{position:"relative",top:-15},children:n})},a):Object(De.jsx)(en,{align:"center",noBorder:!0,colSpan:1,children:Object(De.jsx)(ze.a,{style:{position:"relative",top:-15},children:n})},a):e===t-1?Object(De.jsx)(en,{align:"center",colSpan:1},a):Object(De.jsx)(en,{align:"center",colSpan:1,noBorder:!0},a)},E=function(){var e=P[I],t=e.id;if(!r[t])return"continue";for(var a=0;;){var i,o=!1,l=m[t]?m[t]:1,d=[N(a,l,Object(De.jsx)(ze.a,{component:"div",className:n.foodDesc,children:e.desc}),t)],u=Object(Xe.a)(c);try{var j=function(){var e=i.value;if(!r[t][e.roomName]||!r[t][e.roomName]||!r[t][e.roomName][a]){for(var c=0,u=[0,1,2,3];c<u.length;c++){var j=u[c];d.push(Object(De.jsx)(en,{colSpan:1},"".concat(t).concat(e.roomName).concat(a,"-blank-").concat(j)))}return"continue"}o=!0;var h=r[t][e.roomName][a];d.push(Object(De.jsx)(en,{align:"center",colSpan:1,children:"\uffe5"+h.price},"".concat(t).concat(e.roomName).concat(a,"-price"))),d.push(Object(De.jsx)(en,{align:"center",colSpan:1,children:Object(De.jsx)(ze.a,{component:"div",className:n.foodDesc,children:h.foodDesc})},"".concat(t).concat(e.roomName).concat(a,"-foodDesc"))),d.push(N(a,r[t][e.roomName]?r[t][e.roomName].length:l,"".concat(h.stock,"\u95f4"),"".concat(t).concat(e.roomName).concat(a,"-stock"))),d.push(Object(De.jsx)(en,{align:"center",colSpan:1,children:function(){var e=Kt({roomItem:h}).length;return Object(De.jsxs)(Ze.a,{onClick:0===e?function(){var e=s[t];e.date=p,e.day=f,console.log("day",f,"date",p);var n=re(h);n.parent=e,L(n),Bt(!0),D(!0)}:function(){var e=Kt({roomItem:h});console.log("got tasks",e);var n=s[t];n.date=p,n.day=f,console.log("- day",f,"date",p);var a=re(h);a.parent=n,L(a),W(e)},className:n.planButton,children:["\u8ba1\u5212",e>0?"(".concat(e,")"):""]})}()},"".concat(t).concat(e.roomName).concat(a,"-plan")))};for(u.s();!(i=u.n()).done;)j()}catch(q){u.e(q)}finally{u.f()}if(!o)break;g.push(d),a++}},I=0,P=i;I<P.length;I++)E();return g.map((function(e,t){return Object(De.jsx)(it.a,{style:{height:30},children:e},t)}))};nn||(nn=!0,setTimeout((function(){B&&B()}),6e4));var B=function(){if(tn){var e=we.getState().daemon.reserve_table[p];e&&(v(e),w(e.roomList),me.request("daemon","POST",{daemon_args:{reserve_table:{date:p}}}).then((function(e){200===e.code&&(we.dispatch(Oe(e.data)),tn=!1,b())})))}else tn=!0,me.request("daemon","POST",{daemon_args:{reserve_table:{date:p}}}).then((function(e){200===e.code&&(we.dispatch(Oe(e.data)),tn=!1,b())}))},U=function(){B(),me.request("task","GET").then((function(e){200===e.code&&(we.dispatch(be(e.data.tasks)),W(null),b())}))};if(!m)return B(),Object(De.jsx)(Pe.a,{children:Object(De.jsx)(Qe.a,{})});var z=[Object(De.jsx)(at.a,{align:"center",colSpan:1,children:"\u65f6\u95f4"},"time")];S.map((function(e,t){z.push(Object(De.jsx)(at.a,{align:"center",colSpan:2,children:"\u552e\u5356\u5185\u5bb9"},"a"+e+t)),z.push(Object(De.jsx)(at.a,{align:"center",colSpan:1,children:"\u5e93\u5b58"},"b"+e+t)),z.push(Object(De.jsx)(at.a,{align:"center",colSpan:1,children:"\u8ba1\u5212"},"c"+e+t))}));var V=Object(De.jsxs)(rt.a,{children:[Object(De.jsxs)(it.a,{children:[Object(De.jsxs)(at.a,{align:"center",colSpan:1,children:["[",p.slice(p.length-2,p.length),"\u65e5","\u5468"+["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"][f],"]"]}),S.map((function(e,t){return Object(De.jsxs)(at.a,{align:"center",colSpan:4,children:[e.roomName,"(",e.roomCapacity,")"]},t)}))]}),Object(De.jsx)(it.a,{children:z})]});return m&&m.periodList?Object(De.jsxs)(Pe.a,{children:[Object(De.jsx)(ct.a,{component:st.a,children:Object(De.jsxs)(tt.a,{stickyHeader:!0,className:t.table,children:[V,Object(De.jsx)(nt.a,{children:Object(De.jsx)(G,{data:m,roomList:S})})]})}),Object(De.jsxs)(Le.a,{open:!!I,onClose:function(){W(null)},children:[Object(De.jsx)(Fe.a,{children:"\u4efb\u52a1\u5217\u8868"}),Object(De.jsx)($e.a,{children:I?Object(De.jsx)(Qt,{fullWidth:!0,tasks:I,onUpdate:function(){me.request("task","GET").then((function(e){200===e.code&&(we.dispatch(be(e.data.tasks)),b())}))}}):null}),Object(De.jsxs)(et.a,{children:[Object(De.jsx)(Ae.a,{color:"primary",onClick:function(){Bt(!0),D(!0)},children:"\u6dfb\u52a0\u4efb\u52a1"}),Object(De.jsx)(Ae.a,{color:"primary",onClick:function(){W(null)},children:"\u53d6\u6d88"})]})]}),Object(De.jsx)(zt,{simpleMode:!0,taskOld:T,addMode:!0===T,targets:{roomItem:A,taskName:A&&"{}"!==JSON.stringify(A)?"".concat(A.roomType,"\u5468").concat(de[(new Date).getDay()]).concat(A.parent.periodDesc):null},open:!!T&&A&&"{}"!==JSON.stringify(A),onRefresh:function(){U()},onClose:function(e){D(null),e&&U()},onSave:function(e){return console.log("post task",e),me.request_key("task",e.tid,"POST",{task:e}).then((function(e){console.log("update task done")}))}})]}):Object(De.jsxs)(Pe.a,{children:[Object(De.jsx)("header",{}),Object(De.jsx)(Qe.a,{})]})};function cn(e){var t=e.children,n=e.value,a=e.index,c=Object(qe.a)(e,["children","value","index"]);return Object(De.jsx)("div",Object(u.a)(Object(u.a)({role:"tabpanel",hidden:n!==a,id:"scrollable-auto-tabpanel-".concat(a),"aria-labelledby":"scrollable-auto-tab-".concat(a)},c),{},{children:n===a&&Object(De.jsx)(ze.a,{children:t})}))}var rn=Object(b.a)((function(e){var t;return{root:(t={overflowX:"auto",display:"block",width:"100%",flexGrow:1},Object(j.a)(t,"width","100%"),Object(j.a)(t,"backgroundColor",e.palette.background.paper),t),formControl:{margin:e.spacing(1),minWidth:120},selectEmpty:{marginTop:e.spacing(2)}}}));function sn(e){var t=rn(),n=s.a.useState((new Date).getDay()),a=Object(d.a)(n,2),c=a[0],r=a[1],i=s.a.useState(!1),o=Object(d.a)(i,2),l=o[0],j=o[1],h=s.a.useState(!1),b=Object(d.a)(h,2),f=b[0],O=b[1],p=Object(De.jsxs)("div",{className:t.root,children:[Object(De.jsx)(Be.a,{value:c,onChange:function(e,t){return r(t)},indicatorColor:"primary",textColor:"primary",variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example",children:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"].map((function(e,t){return Object(De.jsx)(Ue.a,Object(u.a)({label:"\u5468"+e},{id:"scrollable-auto-tab-".concat(n=t),"aria-controls":"scrollable-auto-tabpanel-".concat(n)}),e);var n}))}),[0,1,2,3,4,5,6].map((function(e,t){return Object(De.jsx)(cn,{value:c,index:e,children:Object(De.jsx)(an,{day:c})},e)}))]});return Object(De.jsxs)("div",{children:[Object(De.jsxs)(Je.a,{className:t.formControl,children:[Object(De.jsx)(Me.a,{children:"\u9009\u62e9\u65e5\u671f"}),Object(De.jsx)(Ge.a,{value:c,onChange:function(e){r(e.target.value)},children:de.map((function(e,t){return Object(De.jsx)(Re.a,{value:t,children:"\u5468"+e},e)}))})]}),Object(De.jsx)(S.a,{style:{float:"right"},variant:"contained",onClick:function(){j(!0),O(!0)},children:Object(De.jsx)(He.a,{})}),window.innerWidth>=600?p:Object(De.jsxs)(Ae.a,{fullWidth:!0,variant:"contained",onClick:function(){j(!l)},children:["\u70b9\u51fb",l?"\u9690\u85cf":"\u663e\u793a","\u8868\u683c"]}),Object(De.jsxs)(Le.a,{fullScreen:f,onClose:function(){j(!1)},open:l,children:[Object(De.jsxs)(Fe.a,{children:[Object(De.jsxs)(ze.a,{component:"span",children:["\u5468",de[c],"(",(new Date).setDay(c).toDateString(),")\u6570\u636e"]}),f?Object(De.jsx)(S.a,{edge:"end",style:{float:"right"},onClick:function(){O(!1),j(!1)},children:Object(De.jsx)(Ke.a,{})}):Object(De.jsx)(S.a,{style:{float:"right"},variant:"contained",onClick:function(){j(!0),O(!0)},children:Object(De.jsx)(He.a,{})})]}),p]})]})}var on=function(e){Object(Ie.a)(n,e);var t=Object(We.a)(n);function n(e){var a;return Object(Z.a)(this,n),(a=t.call(this,e)).state=we.getState(),a.unsubscribe=we.subscribe((function(){a.setState({timetableNodes:we.getState().timetableNodes,timetablePeriods:we.getState().timetablePeriods,roomStockPlans:we.getState().roomStockPlans})})),a}return Object($.a)(n,[{key:"componentWillUnmount",value:function(){this.unsubscribe()}},{key:"render",value:function(){return Object(De.jsx)(tt.a,{children:Object(De.jsxs)(nt.a,{children:[Object(De.jsxs)(it.a,{children:[Object(De.jsx)(at.a,{align:"center",children:"\u4efb\u52a1\u6570\u91cf"}),Object(De.jsx)(at.a,{align:"center",children:"LABLE1"}),Object(De.jsx)(at.a,{align:"center",children:"LABLE2"})]}),Object(De.jsxs)(it.a,{children:[Object(De.jsxs)(at.a,{align:"center",children:[we.getState().tasks.length,"\u4e2a"]}),Object(De.jsx)(at.a,{align:"center",children:"VALUE1"}),Object(De.jsx)(at.a,{align:"center",children:"VALUE2"})]})]})})}}]),n}(s.a.Component);var ln=function(){return Object(De.jsxs)(Pe.a,{style:{overflowX:"auto",width:"100%"},children:[Object(De.jsx)(y.a,{variant:"h5",children:"\u6267\u884c\u72b6\u6001"}),Object(De.jsx)(on,{}),Object(De.jsx)("br",{}),Object(De.jsx)(y.a,{variant:"h5",children:"\u6570\u636e\u603b\u89c8"}),Object(De.jsx)(sn,{})]})},dn=n(264),un=function(){function e(t){var n=this;Object(Z.a)(this,e),this.connect=this.connect.bind(this),this.url=t||we.getState().config.data.remote_login.server||"ws://127.0.0.1:8081",this.ws=null,this.onopen=function(){console.log("Connection started")},this.ondata=function(e){"code"===e.cmd?n.oncode(e.data):"cookies"===e.cmd&&n.oncookies(e.data)},this.onmessage=function(e){n.ondata(JSON.parse(e.data))},this.onerror=function(e){console.error(e)},this.onclose=function(){console.log("Connection closed")},this.oncode=function(e){console.log("code",e)},this.oncookies=function(e){console.log("cookies",e)}}return Object($.a)(e,[{key:"connect",value:function(){this.ws=this.ws||new WebSocket(this.url),this.ws.onopen=this.onopen,this.ws.onclose=this.onclose,this.ws.onerror=this.onerror,this.ws.onmessage=this.onmessage}},{key:"close",value:function(){this.ws&&this.ws.close()}}]),e}(),jn=n(180);function hn(e){var t=e.children,n=e.style;return Object(De.jsx)(ze.a,{style:n||{width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"column"},children:Object(De.jsx)(ze.a,{style:{width:"100%",textAlign:"center",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:t})})}var bn=function(e){Object(Ie.a)(n,e);var t=Object(We.a)(n);function n(e){var a;return Object(Z.a)(this,n),(a=t.call(this,e)).onFinish=e.onFinish,a.forceLogin=e.forceLogin,a.stateDefault={code:null,loginDone:!1,loginError:null},a.state=a.stateDefault,a.ws_api=null,a.ws_running=!1,a.run_ws=Object(r.a)(c.a.mark((function e(){var t,n,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.ws_running=!0,console.log(we.getState().daemon),a.forceLogin||!(we.getState().daemon&&we.getState().daemon.cookies||a.state.loginDone)){e.next=5;break}return a.ws_running=!1,e.abrupt("return");case 5:return e.next=7,me.request("remote_login","PATCH");case 7:if(t=e.sent,a.forceLogin||!(we.getState().daemon&&we.getState().daemon.cookies||a.state.loginDone)){e.next=11;break}return a.ws_running=!1,e.abrupt("return");case 11:if(n=t.data.server,(i=we.getState().config).data.remote_login.server=n,we.dispatch(he(i)),a.forceLogin||!(we.getState().daemon&&we.getState().daemon.cookies||a.state.loginDone)){e.next=18;break}return a.ws_running=!1,e.abrupt("return");case 18:if(a.ws_api=new un(n),a.ws_api.oncode=function(e){a.forceLogin||!(we.getState().daemon&&we.getState().daemon.cookies||a.state.loginDone)?a.setState({code:e}):a.ws_running=!1},a.ws_api.oncookies=function(){var e=Object(r.a)(c.a.mark((function e(t){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me.request("remote_login","POST",{cookies:t});case 2:if(200===(n=e.sent).code){e.next=6;break}return a.setState({loginDone:!0,loginError:n.message}),e.abrupt("return");case 6:if(console.log("done",n),a.forceLogin||!(we.getState().daemon&&we.getState().daemon.cookies||a.state.loginDone)){e.next=10;break}return a.ws_running=!1,e.abrupt("return");case 10:return a.setState({loginDone:!0}),e.next=13,me.request("remote_login","GET");case 13:200===(r=e.sent).code&&r.data.uid&&we.dispatch(Oe(r.data)),a.onFinish&&a.onFinish();case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.forceLogin||!(we.getState().daemon&&we.getState().daemon.cookies||a.state.loginDone)){e.next=24;break}return a.ws_running=!1,e.abrupt("return");case 24:a.ws_api.connect();case 25:case"end":return e.stop()}}),e)}))),setTimeout(a.run_ws,1e3),a}return Object($.a)(n,[{key:"componentWillUnmount",value:function(){this.ws_api&&this.ws_api.close()}},{key:"render",value:function(){var e=this,t=null;return t=this.state.loginDone?this.state.loginError?Object(De.jsx)(st.a,{style:{width:200,height:200},children:Object(De.jsxs)(hn,{children:[Object(De.jsx)(y.a,{variant:"body1",children:this.state.loginError}),Object(De.jsx)(Ae.a,{variant:"outlined",color:"secondary",onClick:function(){try{clearTimeout(e.run_ws)}catch(t){console.error(t)}e.setState(e.stateDefault);try{e.ws_api&&e.ws_api.connect()}catch(t){console.error(t)}e.ws_api=null,e.ws_running=!1,setTimeout(e.run_ws,1e3)},children:"\u91cd\u8bd5"})]})}):Object(De.jsx)(st.a,{style:{width:200,height:200},children:Object(De.jsx)(hn,{children:"\u767b\u5f55\u5b8c\u6210"})}):this.state.code?Object(De.jsx)(jn,{value:JSON.stringify(this.state.code),size:200}):Object(De.jsx)(st.a,{style:{width:200,height:200},children:Object(De.jsx)(hn,{children:"\u6b63\u5728\u52a0\u8f7d\u4e8c\u7ef4\u7801..."})}),Object(De.jsx)(Pe.a,{maxWidth:"xs",style:{height:.6*window.innerHeight},children:Object(De.jsxs)(hn,{children:[Object(De.jsx)(y.a,{variant:"h5",children:"\u626b\u7801\u767b\u5f55\u4ee5\u7ee7\u7eed"}),Object(De.jsx)("br",{}),t,Object(De.jsx)("br",{}),Object(De.jsx)(y.a,{variant:"body2",color:"textSecondary",children:"\u8bf7\u4f7f\u7528\u7f8e\u56e2\u5f00\u5e97\u5b9d/\u70b9\u8bc4\u7ba1\u5bb6\u626b\u7801\u767b\u5f55"}),Object(De.jsx)(y.a,{variant:"body2",color:"textSecondary",children:'\u70b9\u51fb\u8f6f\u4ef6\u53f3\u4e0b\u89d2"\u6211\u7684"\u2192\u53f3\u4e0a\u89d2\u626b\u7801\u56fe\u6807'}),Object(De.jsx)("br",{}),Object(De.jsx)(Ae.a,{fullWidth:!0,onClick:function(){ye.clear(),setTimeout((function(){window.location.reload()}),500)},children:"\u9000\u51fa\u5f53\u524d\u8d26\u53f7"})]})})}}]),n}(s.a.Component);var fn=function(e){var t=s.a.useState(we.getState().config.data.theme_name),n=Object(d.a)(t,2),a=n[0],i=n[1],o=s.a.useRef(),l=s.a.useState(!1),u=Object(d.a)(l,2),j=u[0],h=u[1],b=s.a.useState(!1),f=Object(d.a)(b,2),O=f[0],p=f[1],x=s.a.useState(!1),g=Object(d.a)(x,2),v=g[0],k=g[1],w=s.a.useState(!1),_=Object(d.a)(w,2),C=_[0],T=_[1],D=s.a.useState(!1),N=Object(d.a)(D,2),E=N[0],I=N[1],W=s.a.useState(!1),P=Object(d.a)(W,2),q=P[0],A=P[1],L=s.a.useState(!1),F=Object(d.a)(L,2),M=F[0],R=F[1],J=function(){var e=we.getState().config;e.data=e.data_default,e.save(),e.load(),we.dispatch(he(e))},G=we.getState().user;return Object(De.jsxs)(Pe.a,{maxWidth:"md",children:[Object(De.jsxs)(m.a,{children:[Object(De.jsx)(jt.a,{children:"\u7528\u6237\u8d26\u53f7"}),Object(De.jsxs)(_e.a,{children:[Object(De.jsx)(Te.a,{primary:"\u7528\u6237\u540d"}),Object(De.jsx)(ot.a,{children:G.username})]}),Object(De.jsx)(_e.a,{button:!0,onClick:function(){T(!0)},children:Object(De.jsx)(Te.a,{primary:"\u8be6\u7ec6\u4fe1\u606f"})}),Object(De.jsx)(_e.a,{button:!0,children:Object(De.jsx)(Te.a,{primary:"\u4fee\u6539\u4fe1\u606f"})}),Object(De.jsx)(_e.a,{button:!0,onClick:function(){ye.clear(),setTimeout((function(){window.location.reload()}),500)},children:Object(De.jsx)(Te.a,{primary:"\u9000\u51fa\u5f53\u524d\u8d26\u53f7"})}),Object(De.jsx)(jt.a,{children:"\u7528\u6237\u95e8\u5e97"}),Object(De.jsx)(_e.a,{button:!0,onClick:function(){k(!0)},children:Object(De.jsx)(Te.a,{primary:"\u5f53\u524d\u95e8\u5e97\u4fe1\u606f"})}),Object(De.jsxs)(_e.a,{button:!0,onClick:function(){I(!0)},children:[Object(De.jsx)(Te.a,{primary:"\u89e3\u7ed1\u5f53\u524d\u95e8\u5e97"}),Object(De.jsx)(ot.a,{children:Object(De.jsx)(y.a,{variant:"body1",color:"textSecondary",children:we.getState().daemon&&we.getState().daemon.shop_info&&we.getState().daemon.shop_info.branchName})})]}),Object(De.jsx)(_e.a,{button:!0,onClick:function(){A(!0)},children:Object(De.jsx)(Te.a,{primary:"\u7ba1\u7406/\u5207\u6362\u5f53\u524d\u5df2\u7ed1\u5b9a\u95e8\u5e97"})}),Object(De.jsx)(_e.a,{button:!0,onClick:function(){R(!0)},children:Object(De.jsx)(Te.a,{primary:"\u7ed1\u5b9a\u5e76\u4e14\u5207\u6362\u5230\u65b0\u7684\u95e8\u5e97"})}),Object(De.jsx)(jt.a,{children:"\u5916\u89c2"}),Object(De.jsxs)(_e.a,{children:[Object(De.jsx)(Te.a,{primary:"\u4e3b\u9898\u8bbe\u7f6e"}),Object(De.jsx)(ot.a,{children:Object(De.jsx)(Je.a,{children:Object(De.jsx)(Ge.a,{value:a,onChange:function(e){i(e.target.value);var t=we.getState().config;t.data.theme_name=e.target.value,t.theme=t.theme_avaliable[t.data.theme_name],t.save(),we.dispatch(he(t)),setTimeout((function(){window.location.reload()}),200)},children:we.getState().config.data.theme_avaliable.map((function(e,t){return Object(De.jsx)(Re.a,{value:e,children:e},e)}))})})})]}),Object(De.jsx)(jt.a,{children:"\u6570\u636e\u7ba1\u7406"}),Object(De.jsx)(_e.a,{button:!0,onClick:function(){!function(e,t){var n=document.createElement("a");n.download=t,n.style.display="none";var a=new Blob([e]);n.href=URL.createObjectURL(a),document.body.appendChild(n),n.click(),document.body.removeChild(n)}(we.getState().config.save(),"\u56e2\u8d2d\u6740\u624b\u914d\u7f6e\u6570\u636e(".concat((new Date).toLocaleString(),").json"))},children:Object(De.jsx)(Te.a,{primary:"\u6570\u636e\u5bfc\u51fa"})}),Object(De.jsxs)(_e.a,{button:!0,onClick:function(){o.current.click()},children:[Object(De.jsx)(Te.a,{primary:"\u6570\u636e\u5bfc\u5165"}),Object(De.jsx)(ot.a,{children:Object(De.jsx)("input",{type:"file",accept:".json",hidden:!0,name:"file-gbk-data",ref:o,onChange:function(e){var t=e.target.files;if(0!==t.length)try{var n=t[0],a=new FileReader;a.readAsText(n,"UTF-8"),a.onload=function(t){var n=t.target.result;try{var a=JSON.parse(n);if(!a.version_frontend)return void we.dispatch(xe("\u6587\u4ef6\u7c7b\u578b\u9519\u8bef\u6216\u8005\u6587\u4ef6\u5df2\u7ecf\u635f\u574f"));if(a.version_frontend>we.getState().config.data.version_frontend)return void we.dispatch(xe("\u5b58\u6863\u6587\u4ef6\u7248\u672c(".concat(a.version_frontend,"\u9ad8\u4e8e\u5f53\u524d\u7248\u672c").concat(we.getState().config.data.version_frontend,")\uff0c\u8bf7\u66f4\u65b0\u5230\u6700\u65b0\u7248")));var c=we.getState().config;c.data=a,we.dispatch(he(c)),we.dispatch(xe("\u6570\u636e\u5bfc\u5165\u5b8c\u6210"))}catch(e){we.dispatch(pe(e))}}}catch(e){we.dispatch(pe(e))}else we.dispatch(xe("\u672a\u9009\u62e9\u6587\u4ef6"))}})})]}),Object(De.jsxs)(_e.a,{children:[Object(De.jsx)(Te.a,{primary:"\u8bbe\u7f6e\u6570\u636e\u540c\u6b65"}),Object(De.jsx)(ot.a,{children:Object(De.jsx)(dn.a,{defaultChecked:we.getState().config.data.settings_async,onChange:function(e){var t=we.getState().config;t.data.settings_async=e.target.checked,t.save(),we.dispatch(he(t))}})})]}),Object(De.jsx)(_e.a,{button:!0,onClick:function(){return h(!0)},children:Object(De.jsx)(Te.a,{primary:"\u56de\u5230\u9ed8\u8ba4\u8bbe\u7f6e"})}),Object(De.jsx)(_e.a,{button:!0,onClick:function(){return p(!0)},children:Object(De.jsx)(Te.a,{primary:"\u5220\u9664\u6240\u6709\u6570\u636e"})})]}),Object(De.jsx)(yt,{data:we.getState().user,open:C,keyNames:{username:"\u7528\u6237\u540d",nick:"\u6635\u79f0",phone:"\u7528\u6237\u624b\u673a\u53f7",profile:"\u8be6\u7ec6\u4fe1\u606f",state:"\u7528\u6237\u72b6\u6001",created_at:"\u521b\u5efa\u4e8e",updated_at:"\u66f4\u65b0\u4e8e"},title:"\u7528\u6237\u4fe1\u606f",onClose:function(){T(!1)}}),Object(De.jsx)(yt,{data:we.getState().daemon,open:v,keyNames:{cookies:"\u8fdc\u7a0b\u767b\u5f55\u51ed\u636e",shop_info:"\u95e8\u5e97\u8be6\u7ec6\u4fe1\u606f",solution_id:"\u89e3\u51b3\u65b9\u6848\u7f16\u53f7"},title:"\u95e8\u5e97\u4fe1\u606f",onClose:function(){k(!1)}}),Object(De.jsxs)(Le.a,{open:j,onClose:function(){return h(!1)},children:[Object(De.jsx)(Fe.a,{children:"\u56de\u5230\u9ed8\u8ba4\u8bbe\u7f6e"}),Object(De.jsx)($e.a,{children:Object(De.jsx)(y.a,{variant:"body1",children:"\u6b64\u64cd\u4f5c\u5c06\u4f1a\u6e05\u9664\u6240\u6709\u8bbe\u7f6e\u6570\u636e\uff0c\u786e\u8ba4\u64cd\u4f5c\uff1f"})}),Object(De.jsxs)(et.a,{children:[Object(De.jsx)(Ae.a,{onClick:function(){return h(!1)},children:"\u53d6\u6d88"}),Object(De.jsx)(Ae.a,{onClick:function(){J(),window.location.reload()},children:"\u786e\u5b9a"})]})]}),Object(De.jsxs)(Le.a,{open:O,onClose:function(){return p(!1)},children:[Object(De.jsx)(Fe.a,{children:"\u5220\u9664\u6240\u6709\u6570\u636e"}),Object(De.jsx)($e.a,{children:Object(De.jsx)(y.a,{variant:"body1",children:"\u6b64\u64cd\u4f5c\u5c06\u4f1a\u6e05\u9664\u8f6f\u4ef6\u6570\u636e\uff0c\u786e\u8ba4\u64cd\u4f5c\uff1f"})}),Object(De.jsxs)(et.a,{children:[Object(De.jsx)(Ae.a,{onClick:function(){return p(!1)},children:"\u53d6\u6d88"}),Object(De.jsx)(Ae.a,{onClick:function(){J(),window.location.reload()},children:"\u786e\u5b9a"})]})]}),Object(De.jsxs)(Le.a,{open:E,onClose:function(){I(!1)},children:[Object(De.jsx)(Fe.a,{children:"\u89e3\u7ed1\u5f53\u524d\u95e8\u5e97"}),Object(De.jsx)($e.a,{children:Object(De.jsxs)(y.a,{variant:"body1",children:["\u6b64\u64cd\u4f5c\u5c06\u4f1a\u89e3\u9664\u95e8\u5e97\u548c",Object(De.jsx)("b",{children:"\u672c\u7f51\u7ad9"}),"\u7684\u6570\u636e\u7ed1\u5b9a\uff0c\u9700\u8981",Object(De.jsx)("b",{children:"\u91cd\u65b0\u7ed1\u5b9a"}),"\u624d\u80fd\u4f7f\u7528\u7f51\u7ad9\u529f\u80fd\u3002\u662f\u5426\u7ee7\u7eed\uff1f"]})}),Object(De.jsxs)(et.a,{children:[Object(De.jsx)(Ae.a,{onClick:function(){I(!1)},children:"\u53d6\u6d88"}),Object(De.jsx)(Ae.a,{onClick:Object(r.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me.request("remote_login","DELETE");case 2:t=e.sent,console.log("delete cookies:",t),200!==t.code?we.dispatch(pe("\u5220\u9664\u5931\u8d25: ".concat(t.code,", ").concat(t.message,", ").concat(t.error))):window.location.reload();case 5:case"end":return e.stop()}}),e)}))),color:"secondary",children:"\u786e\u5b9a"})]})]}),Object(De.jsxs)(Le.a,{open:q,onClose:function(){A(!1)},children:[Object(De.jsx)(Fe.a,{children:"\u9009\u62e9\u4e00\u5bb6\u95e8\u5e97"}),Object(De.jsx)($e.a,{children:Object(De.jsxs)(m.a,{children:[Object(De.jsx)(_e.a,{children:Object(De.jsx)(y.a,{variant:"body2",color:"textSecondary",children:"\u6ce8\u610f\uff0c\u5207\u6362\u95e8\u5e97\u4e4b\u540e\u539f\u6709\u95e8\u5e97\u8ba1\u5212\u5c06\u505c\u6b62\u6267\u884c\u3002"})}),we.getState().daemon.shops?Object.keys(we.getState().daemon.shops).map((function(e,t){var n=we.getState().daemon.shops[e];return Object(De.jsxs)(_e.a,{button:!0,onClick:Object(r.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("switching to",n),n.cookies){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,me.request("remote_login","POST",{cookies:n.cookies});case 5:A(!1);case 6:case"end":return e.stop()}}),e)}))),children:[Object(De.jsx)(ze.a,{style:{display:"flex",flexDirection:"row"},children:Object(De.jsxs)(ze.a,{style:{display:"flex",flexDirection:"column"},children:[Object(De.jsx)(y.a,{variant:"body1",children:"".concat(n.shopName," - ").concat(n.branchName)}),Object(De.jsx)(y.a,{variant:"body2",color:"textSecondary",children:"".concat(n.shopId)})]})}),Object(De.jsx)(ot.a,{children:Object(De.jsx)(S.a,{onClick:Object(r.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("to delete:",n),e.next=3,me.request("remote_login","DELETE",{shop_id:n.shopId});case 3:we.getState().daemon.shop_info&&n.shopId===we.getState().daemon.shop_info.shopId&&window.location.reload();case 4:case"end":return e.stop()}}),e)}))),children:Object(De.jsx)(ft.a,{})})})]},e)})):Object(De.jsx)(_e.a,{children:Object(De.jsx)(Te.a,{children:"\u65e0\u95e8\u5e97\u6570\u636e"})})]})})]}),Object(De.jsx)(Le.a,{open:M,onClose:function(){R(!1)},children:Object(De.jsx)($e.a,{children:Object(De.jsx)(bn,{forceLogin:!0,onFinish:function(){console.log("onFinish"),setTimeout((function(){window.location.reload()}),3e3)}})})})]})},On=(n(186),n(276)),pn=n(141);function xn(e){var t=s.a.useState({username:"",password:"",captcha:"",actionType:"login"}),n=Object(d.a)(t,2),a=n[0],i=n[1],o=s.a.useRef(),l=s.a.useRef(),u=function(e){return i(ie(a,e))},j="login"===a.actionType,h=function(){var e=Object(r.a)(c.a.mark((function e(){var t,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j){e.next=16;break}return e.next=3,me.request("session","POST",{username:a.username,password:a.password});case 3:if(t=e.sent,console.log(t),200===t.code){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,me.request("user","GET");case 9:if(200===(n=e.sent).code){e.next=12;break}return e.abrupt("return");case 12:console.log("user",n.data.user),we.dispatch(fe(n.data.user)),e.next=21;break;case 16:return e.next=18,me.request("user","POST",{username:a.username,password:a.password});case 18:r=e.sent,console.log(r),200===r.code&&(we.dispatch(xe("\u6ce8\u518c\u6210\u529f")),u({actionType:"login"}));case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(De.jsxs)(ze.a,{children:[Object(De.jsx)(y.a,{variant:"h4",children:j?"\u767b\u5f55":"\u6ce8\u518c"}),Object(De.jsx)("br",{}),Object(De.jsx)(k.a,{}),Object(De.jsx)("br",{}),Object(De.jsx)(lt.a,{fullWidth:!0,ref:o,label:"\u7528\u6237\u540d",variant:"outlined",value:a.username,onChange:function(e){u({username:e.target.value})},onKeyDown:function(e){"Enter"===e.code&&l.current.querySelector("input").focus()}}),Object(De.jsx)("br",{}),Object(De.jsx)("br",{}),Object(De.jsx)(lt.a,{fullWidth:!0,ref:l,label:"\u5bc6\u7801",variant:"outlined",value:a.password,type:"password",onChange:function(e){u({password:e.target.value})},onKeyDown:function(e){"Enter"===e.code&&h()}}),Object(De.jsx)(pn.a,{in:j,style:{display:j?"block":"none"},timeout:{exit:0,enter:200},children:Object(De.jsxs)(ze.a,{children:[Object(De.jsxs)(ze.a,{children:[Object(De.jsx)("br",{}),Object(De.jsx)(Ae.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:h,children:"\u767b\u5f55"})]}),Object(De.jsxs)(ze.a,{children:[Object(De.jsx)("br",{}),Object(De.jsx)(Ae.a,{fullWidth:!0,variant:"contained",color:"secondary",onClick:function(){return u({actionType:"sign_in"})},children:"\u6ce8\u518c"})]})]})}),Object(De.jsx)(pn.a,{in:!j,style:{display:j?"none":"block"},timeout:{exit:0,enter:200},children:Object(De.jsxs)(ze.a,{children:[Object(De.jsxs)(ze.a,{children:[Object(De.jsx)("br",{}),Object(De.jsx)(Ae.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:h,children:"\u6ce8\u518c"})]}),Object(De.jsxs)(ze.a,{children:[Object(De.jsx)("br",{}),Object(De.jsx)(Ae.a,{fullWidth:!0,variant:"contained",onClick:function(){return u({actionType:"login"})},children:"\u8fd4\u56de\u767b\u5f55"})]})]})})]})}function gn(e){return Object(De.jsx)(Pe.a,{maxWidth:"sm",children:Object(De.jsx)(xn,{})})}var mn=n(266),vn=n(127),yn=n.n(vn);var kn=function(e){var t=s.a.useState(!1),n=Object(d.a)(t,2),a=n[0],c=n[1],r=s.a.useState(!1),i=Object(d.a)(r,2),o=i[0],l=i[1],u=["\u5c0f\u5305\u6700\u4f4e\u4ef7","\u5c0f\u5305\u6700\u9ad8\u4ef7","\u4e2d\u5305\u6700\u4f4e\u4ef7","\u4e2d\u5305\u6700\u9ad8\u4ef7","\u5927\u5305\u6700\u4f4e\u4ef7","\u5927\u5305\u6700\u9ad8\u4ef7"],h={"\u5c0f\u5305\u6700\u4f4e\u4ef7":"\u5c0f\u5305(\u95f2\u65f6)","\u5c0f\u5305\u6700\u9ad8\u4ef7":"\u5c0f\u5305(\u9ec4\u91d1\u65f6\u6bb5)","\u4e2d\u5305\u6700\u4f4e\u4ef7":"\u4e2d\u5305(\u95f2\u65f6)","\u4e2d\u5305\u6700\u9ad8\u4ef7":"\u4e2d\u5305(\u9ec4\u91d1\u65f6\u6bb5)","\u5927\u5305\u6700\u4f4e\u4ef7":"\u5927\u5305(\u95f2\u65f6)","\u5927\u5305\u6700\u9ad8\u4ef7":"\u5927\u5305(\u9ec4\u91d1\u65f6\u6bb5)"},b=s.a.useState(null),f=Object(d.a)(b,2),O=f[0],p=f[1],x=[["66","76"],["76","86"],["86","96"],["96","106"],["116","126"],["126","146"]],g=u.map((function(e,t){return Object(j.a)({},e,x[t])})),v=function(){var e,t={},n=Object(Xe.a)(g);try{for(n.s();!(e=n.n()).done;){var a=e.value;for(var c in a)t[c]=a[c]}}catch(r){n.e(r)}finally{n.f()}return t}(),w=s.a.useState(v),_=Object(d.a)(w,2),C=_[0],T=_[1],D=function(){var e={};for(var t in C)e[t]=C[t];return e},N=u.map((function(e,t){return a?Object(De.jsxs)(_e.a,{children:[Object(De.jsx)(Te.a,{primary:h[e]}),Object(De.jsx)(ot.a,{children:Object(De.jsxs)(ze.a,{children:[Object(De.jsx)(lt.a,{style:{maxWidth:40},inputProps:{style:{textAlign:"center"}},value:C[e][0],onChange:function(t){var n=D();n[e][0]=t.target.value,T(n)}}),"~",Object(De.jsx)(lt.a,{style:{maxWidth:40},inputProps:{style:{textAlign:"center"}},value:C[e][1],onChange:function(t){var n=D();n[e][1]=t.target.value,T(n)}})]})})]},e):Object(De.jsxs)(_e.a,{children:[Object(De.jsx)(Te.a,{primary:h[e]}),Object(De.jsx)(ot.a,{children:Object(De.jsx)(lt.a,{style:{maxWidth:90},inputProps:{style:{textAlign:"center"}},fullWidth:!0,value:C[e][0],onChange:function(t){var n=D();n[e][0]=t.target.value,T(n)}})})]},e)})),E=Object(De.jsx)(m.a,{children:N}),I=O?Object(De.jsx)(tt.a,{children:Object(De.jsxs)(nt.a,{children:[a?Object(De.jsxs)(it.a,{children:[Object(De.jsx)(at.a,{align:"center",colSpan:2,children:"\u9884\u6d4b\u66dd\u5149\u4eba\u6570"}),Object(De.jsx)(at.a,{align:"center",colSpan:2,children:"\u9884\u6d4b\u8bbf\u95ee\u4eba\u6570"}),Object(De.jsx)(at.a,{align:"center",colSpan:2,children:"\u9884\u6d4b\u4e0b\u5355\u4eba\u6570"})]}):Object(De.jsxs)(it.a,{children:[Object(De.jsx)(at.a,{align:"center",children:"\u9884\u6d4b\u66dd\u5149\u4eba\u6570"}),Object(De.jsx)(at.a,{align:"center",children:"\u9884\u6d4b\u8bbf\u95ee\u4eba\u6570"}),Object(De.jsx)(at.a,{align:"center",children:"\u9884\u6d4b\u4e0b\u5355\u4eba\u6570"})]}),a?Object(De.jsxs)(it.a,{children:[Object(De.jsx)(at.a,{align:"center",children:parseInt(O.visible[0])}),Object(De.jsx)(at.a,{align:"center",children:parseInt(O.visible[1])}),Object(De.jsx)(at.a,{align:"center",children:parseInt(O.visit[0])}),Object(De.jsx)(at.a,{align:"center",children:parseInt(O.visit[1])}),Object(De.jsx)(at.a,{align:"center",children:parseInt(O.order[0])}),Object(De.jsx)(at.a,{align:"center",children:parseInt(O.order[1])})]}):Object(De.jsxs)(it.a,{children:[Object(De.jsx)(at.a,{align:"center",children:parseInt(O.visible[0])}),Object(De.jsx)(at.a,{align:"center",children:parseInt(O.visit[0])}),Object(De.jsx)(at.a,{align:"center",children:parseInt(O.order[0])})]})]})}):null;return Object(De.jsxs)(Pe.a,{maxWidth:"sm",children:[Object(De.jsx)(y.a,{variant:"h4",children:"\u6839\u636e\u6807\u51c6\u6570\u636e\u96c6\u9884\u6d4b"}),Object(De.jsxs)(ze.a,{children:[Object(De.jsx)(mn.a,{control:Object(De.jsx)(dt.a,{onChange:function(e){c(e.target.checked),p(null)},checked:a,color:"secondary"}),label:"\u4f7f\u7528\u6570\u636e\u533a\u95f4"}),Object(De.jsx)(S.a,{onClick:function(){return l(!0)},children:Object(De.jsx)(yn.a,{})})]}),Object(De.jsx)(k.a,{}),E,Object(De.jsx)(Ae.a,{fullWidth:!0,variant:"contained",color:"secondary",onClick:function(){var e=D();if(!a)for(var t in e)e[t]=[e[t][0]];for(var n in e)for(var c=0;c<e[n].length;c++){var r=null;try{r=parseFloat(e[n][c])}catch(i){return void we.dispatch(pe("\u6570\u503c\u9519\u8bef: ".concat(e[n][c],", ").concat(i)))}if(!r&&0!==r)return void we.dispatch(pe("\u6570\u503c\u9519\u8bef: ".concat(e[n][c])));e[n][c]=r}console.log(JSON.stringify(e)),me.request("predicts","POST",{predict_data:e}).then((function(e){console.log(e),p(e.data)}))},children:"\u9884\u6d4b"}),Object(De.jsx)(k.a,{}),I,Object(De.jsxs)(Le.a,{open:o,onClose:function(){l(!1)},children:[Object(De.jsx)(Fe.a,{children:"\u5e2e\u52a9\u4fe1\u606f"}),Object(De.jsxs)($e.a,{children:[Object(De.jsx)(y.a,{variant:"h6",children:"\u4f7f\u7528\u6570\u636e\u533a\u95f4"}),Object(De.jsx)(y.a,{variant:"body1",children:"\u4f7f\u7528\u6570\u636e\u533a\u95f4\u53ef\u4ee5\u8f93\u5165\u6570\u636e\u4e0a\u4e0b\u9650\uff0c\u5e76\u4e14\u9884\u6d4b\u51fa\u5bf9\u5e94\u53c2\u6570\u7684\u4e0a\u4e0b\u9650\uff0c\u5e2e\u52a9\u60a8\u66f4\u597d\u5730\u754c\u5b9a\u60a8\u7684\u6570\u636e\u3002"}),Object(De.jsx)(y.a,{variant:"h6",children:"\u4ef7\u683c\u8bf4\u660e"}),Object(De.jsx)(y.a,{variant:"body1",children:"\u201c\u9ec4\u91d1\u65f6\u6bb5\u201d\u4ef7\u683c\u4e3a\u8282\u5047\u65e5\u3001\u591c\u95f4\u7b49\u9002\u5408\u9ad8\u5b9a\u4ef7\u7684\u65f6\u6bb5\uff0c\u201c\u95f2\u65f6\u201d\u4e3a\u9664\u6b64\u4e4b\u5916\u7684\u65f6\u6bb5\u3002\u8f93\u5165\u4ef7\u683c\u4e3a\u4e0d\u52a0\u5165\u9152\u6c34\u7b49\u7684\u57fa\u7840\u4ef7\u683c\u3002"}),Object(De.jsx)(y.a,{variant:"h6",children:"\u9884\u6d4b\u7ed3\u679c\u8bf4\u660e"}),Object(De.jsx)(y.a,{variant:"body1",children:"\u9884\u6d4b\u7ed3\u679c\u57fa\u4e8e\u5f53\u524d\u5df2\u6709\u6570\u636e\u96c6\u6570\u636e\uff0c\u9884\u6d4b\u51c6\u786e\u6027\u4e0d\u80fd\u767e\u5206\u767e\u4fdd\u8bc1\u3002\u66f4\u65b0\u6570\u636e\u96c6\u7b49\u529f\u80fd\u5c06\u5728\u540e\u7eed\u7248\u672c\u4e0a\u7ebf\u3002"})]}),Object(De.jsx)(et.a,{children:Object(De.jsx)(Ae.a,{color:"primary",onClick:function(){l(!1)},children:"\u4e86\u89e3"})})]})]})},Sn=n(281),wn=Object(b.a)((function(e){return{small:{width:e.spacing(3),height:e.spacing(3)},large:{width:e.spacing(7),height:e.spacing(7)}}}));function _n(e){var t,n=e.onClose,a=wn(),c=we.getState().user,r=c.nick?c.nick:c.username,i=(t=r[0],/[^\u4E00-\u9FA5]/.test(t)?"".concat(r).slice(0,2):null);return Object(De.jsxs)(Pe.a,{maxWidth:"sm",children:[Object(De.jsxs)(ze.a,{style:{display:"flex",flexDirection:"row",minWidth:90},children:[Object(De.jsx)(ze.a,{style:{margin:15},children:Object(De.jsx)(Sn.a,{alt:r,className:a.large,children:i||r[0]})}),Object(De.jsxs)(ze.a,{style:{margin:8},children:[Object(De.jsx)(y.a,{variant:"h4",children:r}),c.username?Object(De.jsxs)(y.a,{variant:"body1",children:["@",c.username]}):null]}),Object(De.jsxs)(ze.a,{style:{margin:10},children:[Object(De.jsx)(y.a,{variant:"h5",children:"".concat(we.getState().daemon.shop_info.shopName)}),Object(De.jsx)(y.a,{variant:"body1",color:"textSecondary",children:"".concat(we.getState().daemon.shop_info.branchName)})]})]}),Object(De.jsx)(B.a,{children:Object(De.jsx)(m.a,{children:Object(De.jsx)(Ee,{to:"/settings",primary:"\u8df3\u8f6c\u5230\u8bbe\u7f6e",onClick:function(){n&&n()}})})})]})}var Cn=function(e){Object(Ie.a)(n,e);var t=Object(We.a)(n);function n(e){var a;return Object(Z.a)(this,n),(a=t.call(this,e)).state={error:null,requesting:!1,requested:!1},a}return Object($.a)(n,[{key:"componentDidCatch",value:function(e,t){var n=this;this.setState({error:{error:e,info:t},requesting:!0}),console.error("catched error",e),console.error("catched info",t),me.request("error_report","POST",{error:{error:e,info:t}}).then((function(e){n.setState({requested:!0})}))}},{key:"render",value:function(){if(this.state.error){var e=this.state.requesting&&!this.state.requested?Object(De.jsx)("div",{style:{color:"orange"},children:"\u6b63\u5728\u6536\u96c6\u6570\u636e\u5e76\u4e14\u4e0a\u62a5\u5f00\u53d1\u8005..."}):Object(De.jsxs)("div",{style:{color:"green"},children:["\u9519\u8bef\u6570\u636e\u4e0a\u62a5\u5b8c\u6210\uff01",Object(De.jsx)("div",{children:"#/"===window.location.hash?null:Object(De.jsxs)("div",{children:[Object(De.jsx)("br",{}),"\u4f60\u53ef\u4ee5\u9009\u62e9\uff1a",Object(De.jsx)("a",{href:"/",children:"\u56de\u5230\u4e3b\u9875"})]})})]});return Object(De.jsxs)("div",{children:[Object(De.jsx)("b",{children:Object(De.jsx)("h3",{children:"\u5f88\u62b1\u6b49"})}),Object(De.jsx)("p",{children:"\u9875\u9762\u5d29\u6e83\u4e86\uff01"}),Object(De.jsx)("hr",{}),e,Object(De.jsx)("p",{children:"\u5bf9\u60a8\u9020\u6210\u7684\u56f0\u6270\u6211\u4eec\u8868\u793a\u62b1\u6b49\uff0c\u5982\u679c\u6709\u5176\u4ed6\u9700\u8981\u89e3\u51b3\u7684\u95ee\u9898\uff0c\u8bf7\u8054\u7cfb\uff1a"}),Object(De.jsxs)("p",{children:["\u7ba1\u7406\u5fae\u4fe1\uff1a",Object(De.jsx)("code",{children:"zhicheng1840"})," / \u5f00\u53d1\u8005\u90ae\u7bb1\uff1a",Object(De.jsx)("a",{href:"mailto:chiro2001@163.com",children:"chiro2001@163.com"})," / \u5f00\u53d1\u8005\u5fae\u4fe1\uff1achiro2001"]}),Object(De.jsx)("hr",{}),Object(De.jsx)("p",{children:"\u8be6\u7ec6\u9519\u8bef\uff1a"}),Object(De.jsx)("code",{children:JSON.stringify(this.state.error)})]})}return this.props.children}}]),n}(s.a.Component),Tn=240;K.a.locale("zh-cn");var Dn=Object(b.a)((function(e){return{root:{display:"flex",width:"100%"},appBar:{zIndex:e.zIndex.drawer+1,transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},title:{flexGrow:1},appBarShift:{marginLeft:Tn,width:"calc(100% - ".concat(Tn,"px)"),transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},menuButton:{marginRight:36},hide:{display:"none"},drawer:{width:Tn,flexShrink:0,whiteSpace:"nowrap"},drawerOpen:{width:Tn,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},drawerClose:Object(j.a)({transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:e.spacing(7)+1},e.breakpoints.up("sm"),{width:e.spacing(9)}),toolbar:Object(u.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:e.spacing(0,1)},e.mixins.toolbar),content:{flexGrow:1,padding:e.spacing(3),width:"100%",overflowX:"auto"}}})),Nn={},En={config:null,user:null,daemon:null};we.subscribe(Object(r.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=we.getState()).config.data){e.next=10;break}if(JSON.stringify(t.config.data)===JSON.stringify(En.config)){e.next=9;break}if(t.config.save(),!we.getState().user||!we.getState().config.data.settings_async){e.next=7;break}return e.next=7,me.request("sync","POST",{config:t.config.data});case 7:e.next=9;break;case 9:En.config=t.config.data;case 10:for(n in Nn)Nn[n](t);case 11:case"end":return e.stop()}}),e)}))));var In=function(){return we.getState().daemon&&we.getState().daemon.shop_info&&we.getState().daemon.shop_info.shopName?"".concat(we.getState().daemon.shop_info.shopName," - ").concat(we.getState().daemon.shop_info.branchName):null};function Wn(){var e,t,n=Dn(),a=Object(f.a)(),i=s.a.useState(!1),o=Object(d.a)(i,2),l=o[0],u=o[1],b=s.a.useState(!1),w=Object(d.a)(b,2),C=w[0],D=w[1],E=s.a.useState(null),W=Object(d.a)(E,2),q=W[0],L=W[1],M=s.a.useState(!1),J=Object(d.a)(M,2),z=(J[0],J[1],"\u56e2\u8d2d\u6740\u624b - KTV\u4f53\u9a8c\u7248"),Y=s.a.useState(In()||z),K=Object(d.a)(Y,2),X=K[0],Q=K[1],Z=s.a.useReducer((function(e){return e+1}),0),$=Object(d.a)(Z,2),ee=($[0],$[1]),te=s.a.useState(!1),ne=Object(d.a)(te,2),ae=ne[0],re=ne[1],ie=s.a.useState(!1),se=Object(d.a)(ie,2),oe=se[0],le=se[1];Nn.Error=function(e){e.errorInfo&&(console.log("Error Hook: ",e.errorInfo),D(e.errorInfo),we.dispatch(pe(null)))},Nn.Message=function(e){e.message&&(console.log("message: ",e.message),L(e.message),we.dispatch(xe(null)))},Nn.User=function(){var e=Object(r.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.user&&(JSON.stringify(t.user)!=JSON.stringify(En.user)&&(ee(),En.user),En.user=t.user);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Nn.Daemon=function(){var e=Object(r.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.daemon&&(JSON.stringify(t.daemon)!=JSON.stringify(En.daemon)&&ee(),En.daemon=t.daemon,t.daemon.shop_info&&X===z&&Q(In()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s.a.useEffect((function(){var e=function(){var e=window.innerWidth;!l&&e>=800&&u(!0),l&&e<=600&&u(!1)};return window.addEventListener("load",e),window.addEventListener("resize",e),function(){window.removeEventListener("load",e),window.removeEventListener("resize",e)}}));var de=Object(De.jsx)(B.a,{children:Object(De.jsxs)(V.a,{utils:H.a,locale:"zh-cn",children:[Object(De.jsx)(v.a,{}),Object(De.jsx)(x.a,{position:"fixed",className:Object(h.a)(n.appBar,Object(j.a)({},n.appBarShift,l)),children:Object(De.jsxs)(g.a,{children:[Object(De.jsx)(S.a,{color:"inherit","aria-label":"open drawer",onClick:function(){u(!0)},edge:"start",className:Object(h.a)(n.menuButton,Object(j.a)({},n.hide,l)),children:Object(De.jsx)(_.a,{})}),Object(De.jsx)(y.a,{variant:"h6",noWrap:!0,className:n.title,children:X}),Object(De.jsx)(S.a,{color:"inherit",onClick:function(){le(!0)},children:Object(De.jsx)(I.a,{})})]})}),Object(De.jsxs)(p.a,{variant:"permanent",className:Object(h.a)(n.drawer,(e={},Object(j.a)(e,n.drawerOpen,l),Object(j.a)(e,n.drawerClose,!l),e)),classes:{paper:Object(h.a)((t={},Object(j.a)(t,n.drawerOpen,l),Object(j.a)(t,n.drawerClose,!l),t))},children:[Object(De.jsx)("div",{className:n.toolbar,children:Object(De.jsx)(S.a,{onClick:function(){u(!1)},children:"rtl"===a.direction?Object(De.jsx)(N.a,{}):Object(De.jsx)(T.a,{})})}),Object(De.jsx)(k.a,{}),Object(De.jsxs)(m.a,{onClick:function(){(window.innerWidth<600||"/"===window.location.pathname)&&u(!1)},children:[Object(De.jsx)(Ee,{to:"/",primary:"\u542f\u52a8\u9875",icon:Object(De.jsx)(A.a,{})}),Object(De.jsx)(Ee,{to:"/tasks",primary:"\u4efb\u52a1",icon:Object(De.jsx)(F.a,{})}),Object(De.jsx)(Ee,{to:"/predicts",primary:"\u667a\u80fd\u9884\u6d4b",icon:Object(De.jsx)(P.a,{})}),Object(De.jsx)(Ee,{to:"/settings",primary:"\u8bbe\u7f6e",icon:Object(De.jsx)(R.a,{})})]})]}),Object(De.jsxs)("main",{className:n.content,children:[Object(De.jsx)("div",{className:n.toolbar}),Object(De.jsxs)(U.c,{children:[Object(De.jsx)(U.a,{path:"/",exact:!0,children:Object(De.jsx)(ln,{})}),Object(De.jsx)(U.a,{path:"/tasks",exact:!0,children:Object(De.jsx)(Zt,{})}),Object(De.jsx)(U.a,{path:"/predicts",exact:!0,children:Object(De.jsx)(kn,{})}),Object(De.jsx)(U.a,{path:"/settings",exact:!1,children:Object(De.jsx)(fn,{})})]})]})]})}),ue=we.getState().user,je=!ue&&we.getState().config.data.api_token.access_token,he=je?Object(De.jsx)(ze.a,{children:"\u6b63\u5728\u767b\u5f55..."}):ue?de:Object(De.jsx)(gn,{});if(je||!ue||we.getState().daemon)!je&&ue&&we.getState().daemon&&!we.getState().daemon.uid&&(he=Object(De.jsx)(bn,{}));else if(he=Object(De.jsx)(y.a,{variant:"body1",children:"\u83b7\u53d6\u8d26\u6237\u4fe1\u606f..."}),!ae){re(!0);me.request("remote_login","GET").then((function(e){200===e.code&&e.data.uid?we.dispatch(Oe(e.data)):200!==e.code||e.data.uid||we.dispatch(Oe({}))}))}return Object(De.jsx)("div",{className:n.root,children:Object(De.jsx)(Cn,{children:Object(De.jsxs)(O.a,{theme:we.getState().config.theme,children:[he,Object(De.jsx)(Le.a,{fullWidth:!0,open:oe,onClose:function(){le(!1)},children:Object(De.jsx)($e.a,{children:Object(De.jsx)(_n,{onClose:function(){le(!1)}})})}),Object(De.jsxs)(Le.a,{open:!!C,onClose:function(){D(null)},children:[Object(De.jsx)(Fe.a,{children:"\u9047\u5230\u9519\u8bef"}),Object(De.jsxs)($e.a,{children:[Object(De.jsx)(y.a,{variant:"body1",children:"\u9519\u8bef\u4fe1\u606f"}),Object(De.jsx)(ze.a,{component:"div",children:Object(De.jsx)(ze.a,{component:"div",children:function(){return ce(C)&&"string"!==typeof C?Object(De.jsx)(m.a,{children:C.map((function(e,t){return Object(De.jsx)(_e.a,{children:Object(De.jsx)("code",{children:"{}"===JSON.stringify(e)?e.toString():JSON.stringify(e)})},e)}))}):Object(De.jsx)("code",{children:"{}"===JSON.stringify(C)?C.toString():JSON.stringify(C)})}})})]}),Object(De.jsxs)(et.a,{children:[Object(De.jsx)(Ae.a,{color:"primary",onClick:function(){window.location.reload()},children:"\u5237\u65b0"}),Object(De.jsx)(Ae.a,{color:"primary",onClick:function(){D(null)},children:"\u53d6\u6d88"})]})]}),Object(De.jsx)(On.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:null!==q,autoHideDuration:3e3,message:q,action:Object(De.jsx)(s.a.Fragment,{children:Object(De.jsx)(S.a,{size:"small","aria-label":"close",color:"inherit",onClick:function(){return L(null)},children:Object(De.jsx)(G.a,{fontSize:"small"})})})})]})})})}var Pn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,283)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)}))};function qn(){return(qn=Object(r.a)(c.a.mark((function e(){var t,n=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.length>0&&void 0!==n[0]?n[0]:1e3;case 1:return e.next=5,ae(t);case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function An(){return(An=Object(r.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout(Object(r.a)(c.a.mark((function e(){var t,n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=we.getState().user,!(!t&&we.getState().config.data.api_token.access_token)){e.next=13;break}return me.load_from_config(),e.next=6,me.request("user","GET");case 6:if(200!==(n=e.sent).code){e.next=13;break}return we.dispatch(fe(n.data.user)),e.next=11,me.request("daemon","GET");case 11:200===(a=e.sent).code&&a.data.uid?we.dispatch(Oe(a.data)):we.dispatch(Oe(null));case 13:case"end":return e.stop()}}),e)}))),0);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}l.a.render(Object(De.jsx)(z.a,{store:we,children:Object(De.jsx)(Wn,{})}),document.getElementById("root")),function(){return An.apply(this,arguments)}().then((function(){!function(){qn.apply(this,arguments)}()})),Pn()}},[[187,1,2]]]);
//# sourceMappingURL=main.c748264a.chunk.js.map